!function(e,n){"function"==typeof define&&define.amd?define(["knockout","jquery","knockout-mapping","accounting-js","blockui"],n):(e.komapping=ko.mapping,e.$$=n(e.ko,e.$,e.komapping,e.accounting))}(this,function(e,n,t,i){function r(){var i=this;this.clientErrorHandlers={},this.serverErrorHandlers={},this.isDefined=function(e){return"undefined"==typeof e?!1:!0},this.redirect=function(e){return window.location.href=e,!0},this.clone=function(e){return jQuery.extend(!0,{},e)},this.cloneObservable=function(e){return t.fromJS(t.toJS(e))},this.replaceAndBind=function(n,t,i){n.html(t),e.cleanNode(n.get(0)),e.applyBindings(i,n.get(0))},this.block=function(e,t){t||(t="Procesando...");var i={message:t,css:{border:"none",padding:"5px",backgroundColor:"#000","-webkit-border-radius":"5px","-moz-border-radius":"5px",opacity:.7,color:"#fff"},baseZ:5e3};e?n(e).block(i):n.blockUI(i)},this.unblock=function(e){e?n(e).unblock():n.unblockUI()},this.getParam=function(e){var n=void 0,t=[];return location.search.substr(1).split("&").forEach(function(i){t=i.split("="),t[0]===e&&(n=decodeURIComponent(t[1]))}),n},this.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},this.isInt=function(e){return Number(e)===e&&e%1===0},this.isNumeric=function(e){return e===Number(e)&&e%1!==0},this.isArray=function(e){return n.isArray(e)},this.isObject=function(e){return null!==e&&"object"==typeof e?!0:!1},this.isFunction=function(e){return null!==e&&"function"==typeof e?!0:!1},this.setCookie=function(e,n,t){var i=new Date;if(void 0!==t){i.setTime(i.getTime()+1e3*t);var r="expires="+i.toUTCString();document.cookie=e+"="+n+"; "+r}else document.cookie=e+"="+n+"; "},this.getCookie=function(e){for(var n=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var r=t[i];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(n))return r.substring(n.length,r.length)}return""},this.ajax=function(e,t,r,a,o,s,d,l){var u="",c="Guardando...";i.isDefined(t)&&null!==t&&(i.isObject(t)?(i.isDefined(t.target)&&(u=t.target),i.isDefined(t.message)&&(c=t.message)):c=t,i.block(u,c));var f={};a&&(f={access_token:i.getCookie("token")}),n.ajax({url:e,type:o,cache:!1,data:s,async:r,success:d,headers:f,error:function(n,r,a){var o=!1;if(i.isDefined(t)&&null!==t&&i.unblock(u),i.isDefined(l)&&(o=l()),!o)if(n.status>=500&&n.status<600){for(handlerName in i.serverErrorHandlers)if(i.serverErrorHandlers[handlerName](e,JSON.parse(n.responseText))){o=!0;break}}else for(handlerName in i.clientErrorHandlers)if(i.clientErrorHandlers[handlerName](e,n,r,a)){o=!0;break}}})},this.htmlEncode=function(e){return e?jQuery("<div />").text(e).html():""},this.htmlDecode=function(e){return e?n("<div />").html(e).text():""},this.limitText=function(e,n){return i.isInt(n)?6>n&&(n=6):n=6,i.isString(e)?(e.length>n&&(e=e.substr(0,n-3)+"..."),e):""},this.components=function(e,n,t){n.childs={};for(var r in e)n.childs[r]={},n.childs[r].load=function(r,a){n[r](a),n.childs[r].loaded=!0,i.isDefined(a.childs)?(n.childs[r].ready=!1,a.parent=n,a.parentState=n.childs[r]):n.childs[r].ready=!0;for(var o in e)if(!n.childs[o].loaded)return;for(var o in e)if(!n.childs[o].ready)return;i.isDefined(t)&&t(),i.isDefined(n.parent)&&(n.parentState.ready=!0,n.parent.childReady())},n.childs[r].loaded=!1,n.childReady=function(){for(var r in e)if(!n.childs[r].ready)return;i.isDefined(t)&&t(),i.isDefined(n.parent)&&(n.parentState.ready=!0,n.parent.childReady())},n[r]=e[r]},this.parameters=function(n,t,r){for(var a in n)r[a]=n[a],i.isDefined(t[a])&&(e.isObservable(r[a])&&e.isObservable(t[a])?r[a]=t[a]:e.isObservable(r[a])&&!e.isObservable(t[a])?r[a](t[a]):!e.isObservable(r[a])&&e.isObservable(t[a])?r[a]=t[a]():e.isObservable(r[a])||e.isObservable(t[a])||(r[a]=t[a]))},this.parametrizeAsObservable=function(n,t){return i.isDefined(n)?e.isObservable(n)?(!n()&&i.isDefined(t)&&n(t),n):(!n&&i.isDefined(t)&&(n=t),e.observable(n)):e.observable(t)},this.parametrizeAsReadOnlyObservable=function(n,t){if(i.isDefined(n)){if(e.isObservable(n))return n(t),n;throw"Parameter must be an observable"}return e.observable(t)},this.parametrizeAsObservableArray=function(n,t){return i.isDefined(n)?e.isObservable(n)?(!n()&&i.isDefined(t)&&n(t),n):(!n&&i.isDefined(t)&&(n=t),e.observableArray(n)):e.observableArray(t)},this.parametrizeAsValue=function(e,n){return i.isDefined(e)?e:n},this.inject=function(n,t){for(var r in n)if(i.isDefined(t[r])){var a;a=e.isObservable(n[r])?n[r]():n[r],e.isObservable(t[r])?t[r](a):t[r]=a}},this.call=function(e){if(i.isDefined(e)){var n=Array.prototype.slice.call(arguments,1);return e.apply(n)}return!0}}r.prototype.dispose=function(){};var a=new r;return e.mapping=t,e.validators={},e.validate=function(n,t){var i=!0;for(var r in n){var a=n[r];e.isObservable(a)&&a.validatable&&(a.validate(t)||(i=!1))}return i},e.validationReset=function(n){for(var t in n){var i=n[t];e.isObservable(i)&&i.validatable&&i.validationReset()}},e.observable.fn.validation=function(n,t,i){return this.validatable=n,this.validationConfig={},this.validationConfig=t,this.hasError=e.observable(),this.validationMessage=e.observable(),i&&(this.parent=i,i.validationSummary||(i.validationSummary=e.observableArray())),this},e.observable.fn.validationReset=function(){var e=this;this.validatable&&(this.hasError(!1),this.validationMessage(""),this.parent&&this.parent.validationSummary.remove(function(n){return n.name===e.validatable}))},e.observable.fn.validateValue=function(n){this.validationReset();for(var t in this.validationConfig){var i=this.validationConfig[t];if(e.validators[t]){var r=e.validators[t](this,i);if(!r.validate(n))return this.parent&&this.parent.validationSummary.push({name:this.validatable,message:this.validationMessage()}),!1}}return!0},e.observable.fn.validate=function(e){return e&&!this.subscription&&(this.subscription=this.subscribe(this.validateValue,this)),this.validateValue(this())},e.getJson=function(n){var i=t.toJS(n);for(var r in i)null===i[r]||void 0===i[r]?delete i[r]:"object"==typeof i[r]&&e.getJson(i[r]);var a=t.toJSON(i);return a=a.replace(/\/Date\(\d+\)/g,function(e){return"\\"+e+"\\"})},e.bindingHandlers.onBind={init:function(n,t,i,r,a){var o=e.unwrap(t());o(n,r,a)}},e.bindingHandlers.formGroupError={init:function(e,t,i,r,o){var s=t(),d=!1;if(a.isArray(s))for(var l=0;l<s.length;l++)s[l].hasError()||(d=!0);else d=s.hasError();d?n(e).addClass("has-error"):n(e).removeClass("has-error")},update:function(e,t,i,r,o){var s=t(),d=!1;if(a.isArray(s))for(var l=0;l<s.length;l++)s[l].hasError()&&(d=!0);else d=s.hasError();d?n(e).addClass("has-error"):n(e).removeClass("has-error")}},e.bindingHandlers.rowSelect={update:function(n,t,i,r,a){var o=e.unwrap(t()),s=function(){return{success:o.isSelected(r)}};e.bindingHandlers.css.update(n,s,i,r,a);var d=function(){return o.select};e.bindingHandlers.click.init(n,d,i,r,a)}},e.bindingHandlers.numericValue={init:function(n,t){var r=t(),o=e.pureComputed({read:function(){return a.isDefined(r())?i.formatNumber(r(),2,".",","):void 0},write:function(e){var n=r(),t=i.unformat(e,",");isNaN(t)&&(t=e),t!==n?r(i.toFixed(t,2)):e!==n.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(n,{value:o})}},e.bindingHandlers.moneyValue={init:function(n,t){var r=t(),a=e.pureComputed({read:function(){return i.formatMoney(r(),"$ ",2,".",",")},write:function(e){var n=r(),t=i.unformat(e,",");isNaN(t)&&(t=e),t!==n?r(i.toFixed(t,2)):e!==n.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(n,{value:a})}},e.bindingHandlers.vm={init:function(n,t,i,r,o){var s;if(s=e.unwrap(t()),!a.isString(s))throw"El valor del binding vm debe ser un string con el nombre de la propiedad del objeto donde se debe cargar el viewmodel del componente anidado";if(!a.isDefined(r.childs))throw"El objeto especificado no tiene la propiedad childs. Esto probablemente se deba a que no uso la funcion .components de quark para definir las propiedades en donde el binding vm debe asignar el viewmodel";if(!a.isDefined(r.childs[s]))throw"El objeto especificado no tiene una propiedad de nombre "+s+". Verifique que el objeto contenga una propiedad definida con el metodo .components a la que apunta este binding vm.";r.childs[s].load(s,o.child)}},e.virtualElements.allowedBindings.vm=!0,e.bindingProvider.instance.preprocessNode=function(e){if(8===e.nodeType){var n=e.nodeValue.match(/^\s*(vm\s*:[\s\S]+)/);if(n){var t=document.createComment("ko "+n[1]),i=document.createComment("/ko");return e.parentNode.insertBefore(t,e),e.parentNode.replaceChild(i,e),[t,i]}}},e.bindingHandlers.componentShadyDom={init:function(n,t,i,a,o){var s=function(){return{nodes:o.$componentTemplateNodes,afterRender:function(){r.isDefined(o.$parent.init)&&o.$parent.init()}}};return e.bindingHandlers.template.init(n,s,i,o.$parent,o.$parentContext)},update:function(n,t,i,r,a){var o=function(){return{nodes:a.$componentTemplateNodes}};return e.bindingHandlers.template.update(n,o,i,a.$parent,a.$parentContext)}},e.virtualElements.allowedBindings.componentShadyDom=!0,e.bindingHandlers.modelExporter={init:function(n,t,i,r,a){var o=function(){for(var e=Array(),n=0;n<a.$parentContext.$componentTemplateNodes.length;n++){var t=a.$parentContext.$componentTemplateNodes[n];if(8===t.nodeType){var i=t.nodeValue.indexOf("vm:")>-1;i&&e.push(t)}}return{nodes:e,"if":e.length>0}},s=a.$parentContext.$parentContext.extend({child:a.$parent});return e.bindingHandlers.template.init(n,o,i,a.$parent,s)},update:function(n,t,i,r,a){var o=function(){for(var e=Array(),n=0;n<a.$parentContext.$componentTemplateNodes.length;n++){var t=a.$parentContext.$componentTemplateNodes[n];if(8===t.nodeType){var i=t.nodeValue.indexOf("vm:")>-1;i&&e.push(t)}}return{nodes:e,"if":e.length>0}},s=a.$parentContext.$parentContext.extend({child:a.$parent});return e.bindingHandlers.template.update(n,o,i,a.$parent,s)}},e.virtualElements.allowedBindings.modelExporter=!0,e.bindingHandlers.content={init:function(t,i,r,o,s){var d=e.unwrap(i()),l=function(){return a.isInt(d)?{nodes:s.$componentTemplateNodes.slice(d)}:{nodes:n(s.$componentTemplateNodes).filter(d)}};return e.bindingHandlers.template.init(t,l,r,s.$parent,s.$parentContext)},update:function(t,i,r,o,s){var d=e.unwrap(i()),l=function(){return a.isInt(d)?{nodes:s.$componentTemplateNodes.slice(d)}:{nodes:n(s.$componentTemplateNodes).filter(d)}};return e.bindingHandlers.template.update(t,l,r,s.$parent,s.$parentContext)}},e.virtualElements.allowedBindings.content=!0,e.bindingHandlers.hasContent={init:function(t,i,r,a,o){var s=e.unwrap(i()),d=function(){return n(o.$componentTemplateNodes).filter(s).length>0};return e.bindingHandlers["if"].init(t,d,r,o,o)}},e.virtualElements.allowedBindings.hasContent=!0,e.validators.required=function(e,n){return this.validate=function(t){return e.validationReset(),t?!0:(e.hasError(!0),e.validationMessage((n.message||"El campo {0} es obligatorio").replace("{0}",e.validatable)),!1)},this},e.validators.length=function(e,n){return this.validate=function(t){e.validationReset();var i=0;return t&&(i=t.length),n.min&&i<n.min?(e.hasError(!0),e.validationMessage((n.message||"El campo {0} debe tener al menos {1} caracteres").replace("{0}",e.validatable).replace("{1}",n.min).replace("{2}",n.max)),!1):n.max&&i>n.max?(e.hasError(!0),e.validationMessage((n.message||"El campo {0} debe tener como maximo {2} caracteres").replace("{0}",e.validatable).replace("{1}",n.min).replace("{2}",n.max)),!1):!0},this},e.validators.numero=function(e,n){return this.validate=function(t){return e.validationReset(),""!==t&&isNaN(t)?(e.hasError(!0),e.validationMessage((n.message||"El campo {0} debe ser un numero valido").replace("{0}",e.validatable)),!1):!0},this},e.validators.entero=function(e,n){return this.validate=function(t){return e.validationReset(),""!==t&&a.isInt(t)?(e.hasError(!0),e.validationMessage((n.message||"El campo {0} debe ser un numero entero valido").replace("{0}",e.validatable)),!1):!0},this},e.validators.fecha=function(e,n){return this.validate=function(t){e.validationReset();var i=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/;return""===t||i.test(t)?!0:(e.hasError(!0),e.validationMessage((n.message||"El campo {0} debe ser una fecha valida").replace("{0}",e.validatable)),!1)},this},"function"==typeof define&&define.amd&&define("knockout",function(){return e}),a});