!function(e,n){"function"==typeof define&&define.amd?define(["knockout","jquery","knockout-mapping","accounting-js","blockui"],n):(e.komapping=ko.mapping,e.$$=n(e.ko,e.$,e.komapping,e.accounting))}(this,function(e,n,i,t){function r(e,n){if(!p.isString(n))throw"The behaviour name must be an string. If you specified an array check that all elements are valid behaviour names";if(!p.behaviours[n])throw"The are no behaviours loaded with the name "+n+".";p.behaviours[n](e)}function a(n){var i=e.unwrap(n());i()}function o(n,i,t){var r=e.unwrap(n()),a=t.$child,o=r;p.isObject(r)&&p.isDefined(r.data)&&p.isDefined(r.target)&&(a=r.target,o=r.data),p.inject(o,a)}function s(e){var n=function(){return{nodes:e.$componentTemplateNodes}};return n}function d(e,n,i,t,r){var a=function(){for(var e=Array(),n=0;n<r.$parentContext.$componentTemplateNodes.length;n++){var i=r.$parentContext.$componentTemplateNodes[n];if(8===i.nodeType){var t=i.nodeValue.indexOf("vm:")>-1;t&&e.push(i),t=i.nodeValue.indexOf("call:")>-1,t&&e.push(i),t=i.nodeValue.indexOf("inject:")>-1,t&&e.push(i)}}return{nodes:e,"if":e.length>0}};return a}function c(i,t,r,a,o){var s=e.unwrap(t()),d=function(){return p.isInt(s)?{nodes:o.$componentTemplateNodes.slice(s)}:{nodes:n(o.$componentTemplateNodes).filter(s)}};return d}function l(i,t,r,a,o){var s=e.unwrap(t()),d=function(){return n(o.$componentTemplateNodes).filter(s).length>0};return d}function u(n){this.validationReset();for(var i in this.validationConfig){var t=this.validationConfig[i];if(e.validators[i]){var r=e.validators[i](this,t);if(!r.validate(n))return this.parent&&this.parent.validationSummary.push({name:this.validatable,message:this.validationMessage()}),!1}}return!0}function f(e,i,t,r,a){var o=i(),s=!1;if(p.isArray(o))for(var d=0;d<o.length;d++)o[d].hasError()||(s=!0);else s=o.hasError();s?n(e).addClass("has-error"):n(e).removeClass("has-error")}var p={};return p.isDefined=function(e){return"undefined"==typeof e?!1:!0},p.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},p.isInt=function(e){return Number(e)===e&&e%1===0},p.isNumeric=function(e){return"number"==typeof e},p.isDecimal=function(e){return e===Number(e)&&e%1!==0},p.isArray=function(e){return n.isArray(e)},p.isObject=function(e){return null===e||"object"!=typeof e||e instanceof Array?!1:!0},p.isFunction=function(e){return null!==e&&"function"==typeof e?!0:!1},p.isDate=function(e){return e instanceof Date?!0:!1},p.isValidDate=function(e){return p.isDate(e)?isNaN(e.getTime())?!1:!0:!1},p.clone=function(e){return n.extend(!0,{},e)},p.cloneObservable=function(e){return i.fromJS(i.toJS(e))},p.cloneMixed=function(n){var i=new n.constructor;for(var t in n){var r;e.isObservable(n[t])?(r=n[t](),p.isObject(r)?i[t]=e.observable(p.cloneMixed(r)):i[t]=e.observable(r)):(r=n[t],p.isObject(r)?i[t]=p.cloneMixed(r):i[t]=r)}return i},p.call=function(n){if(e.isObservable(n)&&(n=n()),e.isObservable(n))throw"Callback can not be an observable";if(p.isFunction(n)){var i=Array.prototype.slice.call(arguments,1);return n.apply(null,i)}},p.makeDate=function(e,n){if(p.isDate(e)||(e=new Date(e)),!p.isValidDate(e)){if(!n)return void 0;e=new Date}return e},p.behaviours={},p.behaviour=function(e,n){if(p.behaviour[e]&&console.warn("There was already a behaviour loaded with the name "+e+". It will be replaced with the new one."),!p.isString(e))throw"The behaviour name must be an string.";if(!p.isFunction(n))throw"The behaviour must be a function that takes an object as a parameter an applies the new functionality to it.";p.behaviours[e]=n},p.behave=function(e,n){if(!p.isObject(e))throw"You must specifify a valid object to apply the behaviour.";if(p.isArray(n))for(var i=0;i<n.length;i++)r(e,n[i]);else{if(!p.isString(n))throw"The behaviour name must be an string or an array of strings.";r(e,n)}},p.config=function(n,i,t){if(!p.isObject(n))throw"You must specify a config object";if(!p.isObject(i))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!p.isDefined(t))throw"You must specify the viewmodel of the component in wich to load the configuration.";p.isDefined(t.config)||(t.config={});for(var r in n)p.isDefined(t.config[r])||console.warn("There is already a config property named "+r+" in the target component. The property will be replaced."),t.config[r]=n[r],e.isObservable(t.config[r])&&console.warn("Property "+r+" should not be observable. The configuration parameters should be static, if you want the object to react to parameter changes use the parameters method."),p.isDefined(i[r])&&(e.isObservable(i[r])?t.config[r]=i[r]():t.config[r]=i[r])},p.parameters=function(n,i,t){if(!p.isObject(n))throw"You must specify a parameters config object";if(!p.isObject(i))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!p.isDefined(t))throw"You must specify the viewmodel of the component in wich to load the parameters.";for(var r in n)if(p.isDefined(t[r])||console.warn("There is already a property named "+r+" in the target component. It will be replaced with the specified parameter."),t[r]=n[r],p.isDefined(i[r]))if(e.isObservable(t[r])&&e.isObservable(i[r]))e.isComputed(t[r])||(t[r]=i[r]);else if(e.isObservable(t[r])&&!e.isObservable(i[r]))t[r](i[r]);else if(!e.isObservable(t[r])&&e.isObservable(i[r]))t[r]=i[r]();else if(!e.isObservable(t[r])&&!e.isObservable(i[r]))if(p.isFunction(t[r])){if(p.isFunction(i[r]))t[r]=i[r];else if(p.isDefined(i[r]))throw"The parameter "+r+" must be a callback."}else t[r]=i[r]},p.components=function(n,i,t){if(!p.isObject(n))throw"You must specify a childs config object";if(!p.isDefined(i))throw"You must specify the viewmodel of the component in wich to load the child viewmodels.";p.isDefined(i._tracking)&&console.warn("The object already contains a property _tracking, it will be replaced by the tracking array"),i.tracking={childs:{}};for(var r in n)i.tracking.childs[r]={},i.tracking.childs[r].load=function(r,a){e.isObservable(i[r])?i[r](a):i[r]=a,i.tracking.childs[r].loaded=!0,p.isDefined(a.tracking)?(i.tracking.childs[r].ready=!1,a.tracking.parent=i,a.tracking.parentState=i.tracking.childs[r]):(i.tracking.childs[r].ready=!0,p.isDefined(a.ready)&&a.ready());for(var o in n)if(!i.tracking.childs[o].loaded)return;for(var o in n)if(!i.tracking.childs[o].ready)return;p.isDefined(t)&&t(),p.isFunction(i.ready)&&i.ready(),p.isDefined(i.tracking)&&p.isDefined(i.tracking.parent)&&(i.tracking.parentState.ready=!0,i.tracking.parent.childReady())},i.tracking.childs[r].loaded=!1,i.tracking.childReady=function(){for(var e in n)if(!i.tracking.childs[e].ready)return;p.isDefined(t)&&t(),p.isFunction(i.ready)&&i.ready(),p.isDefined(i.parent)&&(i.traking.parentState.ready=!0,i.tracking.parent.childReady())},i[r]=n[r]},p.inject=function(n,i,t){if(p.isDefined(n)&&p.isDefined(i))for(var r in n)if(p.isDefined(i[r])){var a;a=e.isObservable(n[r])?n[r]():n[r],e.isObservable(i[r])?t&&p.isObject(i[r]())?p.inject(i[r](),a):i[r](a):t&&p.isObject(i[r])?p.inject(i[r],a):i[r]=a}},e.bindingProvider.instance.preprocessNode=function(e){var n=function(n){var i=e.nodeValue.match(n);if(i){var t=document.createComment("ko "+i[1]),r=document.createComment("/ko");return e.parentNode.insertBefore(t,e),e.parentNode.replaceChild(r,e),[t,r]}return!1};if(8===e.nodeType){var i;return i=n(/^\s*(vm\s*:[\s\S]+)/),i=i?i:n(/^\s*(call\s*:[\s\S]+)/),i=i?i:n(/^\s*(inject\s*:[\s\S]+)/)}},e.bindingHandlers.onBind={init:function(n,i,t,r,a){var o=e.unwrap(i());o(n,r,a)}},e.bindingHandlers.vm={init:function(n,i,t,r,a){var o;o=e.unwrap(i());var s;if(p.isString(o)?s=o:p.isObject(o)&&(p.isString(o.property)&&(s=o.property),p.isDefined(o.model)&&(r=o.model)),!p.isString(s))throw"El valor del binding vm debe ser un string con el nombre de la propiedad del objeto donde se debe cargar el viewmodel del componente anidado";if(!p.isDefined(r.tracking))throw"El objeto especificado no tiene la propiedad tracking. Esto probablemente se deba a que no uso la funcion .components de quark para definir las propiedades en donde el binding vm debe asignar el viewmodel";if(!p.isDefined(r.tracking.childs))throw"El objeto especificado no tiene la propiedad childs en el tracking. Esto probablemente se deba a que no uso la funcion .components de quark para definir las propiedades en donde el binding vm debe asignar el viewmodel";if(!p.isDefined(r.tracking.childs[s]))throw"El objeto especificado no tiene una propiedad de nombre "+o+". Verifique que el objeto contenga una propiedad definida con el metodo .components a la que apunta este binding vm.";r.tracking.childs[s].load(s,a.$child)}},e.virtualElements.allowedBindings.vm=!0,e.bindingHandlers.call={init:function(e,n,i,t,r){a(n)},update:function(e,n,i,t,r){a(n)}},e.virtualElements.allowedBindings.call=!0,e.bindingHandlers.inject={init:function(e,n,i,t,r){o(n,t,r)},update:function(e,n,i,t,r){o(n,t,r)}},e.virtualElements.allowedBindings.inject=!0,e.bindingHandlers.componentShadyDom={init:function(n,i,t,r,a){var o=s(a);return e.bindingHandlers.template.init(n,o,t,a.$parent,a.$parentContext)},update:function(n,i,t,r,a){var o=s(a);return e.bindingHandlers.template.update(n,o,t,a.$parent,a.$parentContext)}},e.virtualElements.allowedBindings.componentShadyDom=!0,e.bindingHandlers.modelExporter={init:function(n,i,t,r,a){var o=d(n,i,t,r,a),s=a.$parentContext.$parentContext.extend({$child:a.$parent,$childContext:a});return e.bindingHandlers.template.init(n,o,t,a.$parent,s)},update:function(n,i,t,r,a){var o=d(n,i,t,r,a),s=a.$parentContext.$parentContext.extend({$child:a.$parent,$childContext:a});return e.bindingHandlers.template.update(n,o,t,a.$parent,s)}},e.virtualElements.allowedBindings.modelExporter=!0,e.bindingHandlers.content={init:function(n,i,t,r,a){var o=c(n,i,t,r,a),s=a.$parentContext.extend({$child:r,$childContext:a});return e.bindingHandlers.template.init(n,o,t,a.$parent,s)},update:function(n,i,t,r,a){var o=c(n,i,t,r,a),s=a.$parentContext.extend({$child:r,$childContext:a});return e.bindingHandlers.template.update(n,o,t,a.$parent,s)}},e.virtualElements.allowedBindings.content=!0,e.bindingHandlers.hasContent={init:function(n,i,t,r,a){var o=l(n,i,t,r,a);return e.bindingHandlers["if"].init(n,o,t,a,a)}},e.virtualElements.allowedBindings.hasContent=!0,e.bindingHandlers.hasNotContent={init:function(n,i,t,r,a){var o=l(n,i,t,r,a);return e.bindingHandlers.ifnot.init(n,o,t,a,a)}},e.virtualElements.allowedBindings.hasNotContent=!0,p.redirect=function(e){return window.location.href=e,!0},p.getParam=function(e){var n=void 0,i=[];return location.search.substr(1).split("&").forEach(function(t){i=t.split("="),i[0]===e&&(n=decodeURIComponent(i[1]))}),n},p.replaceAndBind=function(i,t,r){n(i).html(t),e.cleanNode(i.get(0)),e.applyBindings(r,i.get(0))},p.block=function(e,i){e||(e="Loading...");var t={message:e,css:{border:"none",padding:"5px",backgroundColor:"#000","-webkit-border-radius":"5px","-moz-border-radius":"5px",opacity:.7,color:"#fff"},baseZ:5e3};i?n(i).block(t):n.blockUI(t)},p.unblock=function(e){e?n(e).unblock():n.unblockUI()},p.htmlEncode=function(e){return e?n("<div />").text(e).html():""},p.htmlDecode=function(e){return e?n("<div />").html(e).text():""},p.limitText=function(e,n){return p.isInt(n)?6>n&&(n=6):n=6,p.isString(e)?(e.length>n&&(e=e.substr(0,n-3)+"..."),e):""},p.setCookie=function(e,n,i){var t=new Date;if(void 0!==i){t.setTime(t.getTime()+1e3*i);var r="expires="+t.toUTCString();document.cookie=e+"="+n+"; "+r}else document.cookie=e+"="+n+"; "},p.getCookie=function(e){e+="=";for(var n=document.cookie.split(";"),i=0;i<n.length;i++){for(var t=n[i];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length)}return""},p.clientErrorHandlers={},p.serverErrorHandlers={},p.ajax=function(e,i,t,r,a){var o=a||{},s=r||{};if(!e)throw"Must specify the target URL";p.isDefined(o.headers)||(o.headers={}),o.auth&&(o.headers={access_token:sessionStorage.getItem("token")});var d;p.isFunction(s)?d=s:p.isObject(s)&&(d=s.onSuccess),n.ajax({url:e,type:o.method||"GET",cache:o.cache||!1,data:t,async:o.async||!0,success:d,headers:o.headers||{},error:function(n,i,t){var r=!1;if(p.isDefined(s.onError)&&(r=s.onError()),!r)if(n.status>=500&&n.status<600){for(var a in p.serverErrorHandlers)if(p.serverErrorHandlers[a](e,JSON.parse(n.responseText))){r=!0;break}}else for(a in p.clientErrorHandlers)if(p.clientErrorHandlers[a](e,n,i,t)){r=!0;break}}})},e.isObservableArray=function(n){return e.isObservable(n)&&void 0!==n.indexOf?!0:!1},e.isComputed=function(n){return null===n||void 0===n||void 0===n.__ko_proto__?!1:n.__ko_proto__===e.dependentObservable?!0:e.isComputed(n.__ko_proto__)},e.getJson=function(n){var t=i.toJS(n);for(var r in t)null===t[r]||void 0===t[r]?delete t[r]:"object"==typeof t[r]&&e.getJson(t[r]);var a=i.toJSON(t);return a=a.replace(/\/Date\(\d+\)/g,function(e){return"\\"+e+"\\"})},e.computedParameter=function(n,i,t){return e.isObservable(n)||(n=e.observable(n)),e.computed({read:function(){return i.read(n)},write:function(e){return i.write(n,e)}},t)},e.bindingHandlers.rowSelect={update:function(n,i,t,r,a){var o=e.unwrap(i()),s=function(){return{success:o.isSelected(r)}};e.bindingHandlers.css.update(n,s,t,r,a);var d=function(){return o.select};e.bindingHandlers.click.init(n,d,t,r,a)}},e.bindingHandlers.numericValue={init:function(n,i){var r=i(),a=e.pureComputed({read:function(){return p.isDefined(r())?t.formatNumber(r(),2,".",","):void 0},write:function(e){var n=r(),i=t.unformat(e,",");isNaN(i)&&(i=e),i!==n?r(t.toFixed(i,2)):e!==n.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(n,{value:a})}},e.bindingHandlers.moneyValue={init:function(n,i){var r=i(),a=e.pureComputed({read:function(){return t.formatMoney(r(),"$ ",2,".",",")},write:function(e){var n=r(),i=t.unformat(e,",");isNaN(i)&&(i=e),i!==n?r(t.toFixed(i,2)):e!==n.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(n,{value:a})}},e.validators={},e.validate=function(n,i){var t=!0;for(var r in n){var a=n[r];e.isObservable(a)&&a.validatable&&(a.validate(i)||(t=!1))}return t},e.validationReset=function(n){for(var i in n){var t=n[i];e.isObservable(t)&&t.validatable&&t.validationReset()}},e.observable.fn.validation=function(n,i,t){return this.validatable=n,this.validationConfig={},this.validationConfig=i,this.hasError=e.observable(),this.validationMessage=e.observable(),t&&(this.parent=t,t.validationSummary||(t.validationSummary=e.observableArray())),this},e.observable.fn.validationReset=function(){var e=this;this.validatable&&(this.hasError(!1),this.validationMessage(""),this.parent&&this.parent.validationSummary.remove(function(n){return n.name===e.validatable}))},e.observable.fn.validate=function(e){return e&&!this.subscription&&(this.subscription=this.subscribe(u,this)),u(this())},e.bindingHandlers.formGroupError={init:function(e,n,i,t,r){f(e,n,i,t,r)},update:function(e,n,i,t,r){f(e,n,i,t,r)}},"function"==typeof define&&define.amd&&define("knockout",function(){return e}),p});
