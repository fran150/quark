!function(e,n){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module)n(require(["knockout","jquery","knockout-mapping","crossroads","hasher","signals","stacktrace"]),exports);else{if("function"!=typeof define||!define.amd)throw new Error("Quark.js must be used as an AMD module, it must not be included with an script tag");define(["knockout","jquery","knockout-mapping","crossroads","hasher","signals","stacktrace"],n)}}(this,function(e,n,t,r,i,o,a){function s(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function u(e,n,t){return e.replace(new RegExp(s(n),"g"),t)}function c(e,n,t,r){var i="_object: "+e,o=B.call(this,i,n,t,r),a=o._object();return d(a,function(e){return function(){return e}})}function d(e,n){if(!e)return e;var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=n(e[r],r,e));return t}function l(n,t){var r=n(),i=t.get("formatter");if(!H.isString(i)&&!H.isObject(i)&&!H.isFunction(i))throw new Error("Must specify formatter name, function or object");e.isObservable(r)||(r=e.observable(r));var o;o=H.isString(i)?H.formatters[i]:i;var a={};if(!H.isDefined(o))throw new Error("No formatter found with the specified name: "+i);if(H.isFunction(o))a.read=function(){return H.isDefined(r())?o(r()):r()};else{if(!H.isObject(o))throw new Error("The formatter object must be a function or an object with read and write properties");H.isFunction(o.read)&&(a.read=function(){return H.isDefined(r())?o.read(r()):r()}),H.isFunction(o.write)&&(a.write=function(e){r(H.isDefined(e)?o.write(e):e)})}return e.pureComputed(a)}function f(e){var n=e||!1,t=H.signal();this.lock=function(){n=!1},this.force=function(){n=!0},this.unlock=function(){n=!0,t.dispatch()},this.isLocked=function(){return!n},this.call=function(e){n?e():t.addOnce(function(){n=!0,e()})},this.dispose=function(){H.signalClear(t)}}function p(e,n,t,r){this.component=n,this.node=t,this.message=e,this.stack=r.stack}function v(e,n,t){t=t||"";for(var r in n){var i,o=n[r];i=r?e?e+"-"+r:r:e,H.isString(o)?t?H.registerComponent(i,t+"/"+o):H.registerComponent(i,o):v(i,o,t)}}function m(){function e(e,t,r){if(!H.isString(e))throw new Error("The behaviour name must be an string. If you specified an array check that all elements are valid behaviour names");if(!n[e])throw new Error("The are no behaviours loaded with the name "+e+".");n[e](t,r),H.isDefined(t.behaviours)||(t.behaviours={}),t.behaviours[e]=!0}var n={};this.define=function(e,t,r){if(n[e]&&console.warn("There was already a behaviour loaded with the name "+e+". It will be replaced with the new one."),!H.isString(e))throw new Error("The behaviour name must be an string.");if(!H.isFunction(t))throw new Error("The behaviour must be a function that takes an object as a parameter an applies the new functionality to it.");if(H.isDefined(r)&&!H.isFunction(r))throw new Error("The behaviour dispose must be a function that performs cleanup of the behaviour when disposing.");t.dispose=r,n[e]=t},this.apply=function(n,t,r){if(!H.isObject(t))throw new Error("You must specifify a valid object to apply the behaviour.");if(H.isArray(n))for(var i=0;i<n.length;i++)e(n[i],t,r);else{if(!H.isString(n))throw new Error("The behaviour name must be an string or an array of strings.");e(n,t,r)}},this.has=function(e,n){if(!H.isObject(n))throw new Error("You must specifify a valid object to check the behaviour.");if(!H.isString(e))throw new Error("The behaviour name must be an string.");return!(!H.isDefined(n.behaviours)||!H.isDefined(n.behaviours[e]))},this.dispose=function(e){if(!H.isObject(e))throw new Error("You must specifify a valid object to apply the behaviour.");if(H.isDefined(e.behaviours))for(var t in e.behaviours){var r=n[t];r&&H.isFunction(n[behaviourName].dispose)&&n[behaviourName].dispose(e)}}}function h(e){var n=function(){return{nodes:e.$componentTemplateNodes}};return n}function b(e){var n=e.$parent,t=e.$parentContext,r=e.extend({$component:n.getModel(),$componentTemplateNodes:t.$componentTemplateNodes,$data:n.getScope(),$parent:t.$parent?t.$parent.model:void 0,$parentContext:t.$parentContext,$parents:t.$parents,$rawData:n.getScope(),$root:t.$root});return H.isArray(r.$parents)&&r.$parents[0]&&r.$parents[0].model&&(r.$parents[0]=r.$parents[0].model),r}function g(n,t){for(var r=e.virtualElements.childNodes(n),i=0;i<r.length;i++)if(r[i]==t)return!0;return!1}function w(e){for(var n=e.previousSibling;null!=n;){if(g(n,e))return n;n=n.previousSibling}if(null==n)return e.parentNode}function y(e){if(8==e.nodeType){var n=e.nodeValue.match(/model-bind[\s]*:[\s]*\"[\s\S]*?\"/);if(n){var t=n[0].match(/\"[\s\S]*?\"/);if(t){var r=t[0].indexOf('"')+1,i=t[0].indexOf('"',r);return t[0].substring(r,i)}}}else if(e.attributes)for(var o=0;o<e.attributes.length;o++){var a=e.attributes[o];if(a.specified&&"model-bind"==a.name)return a.value}return!1}function x(e){var n=function(){var n=Array(),t=w(e);t=w(t);var r=y(t);return r&&(n.push(document.createComment(" ko "+r+" ")),n.push(document.createComment(" /ko "))),{nodes:n,if:n.length>0}};return n}function k(e){var n=e.$parentContext.$parentContext,t=e.$parent,r=n.extend({$child:t.getModel(),$childContext:e.$parentContext});return r}function C(){function e(e){this.name=e,this.loaded=!1,this.ready=!1,this.model=void 0,this.tracker=void 0}function n(){for(var e in i){var n=i[e];if(!n.loaded||!n.ready)return!1}return!0}var t,r=this,i={},o=!1,a="";this.ready=H.lock(),this.loaded=H.signal(),this.readied=H.signal(),this.isReady=function(){return!r.ready.isLocked()},this.addDependency=function(n){r.ready.lock(),i[n]=new e(n)},this.removeDependency=function(e){if(i[e]){var n=i[e].tracker;n&&(n.parent=""),delete i[e]}},this.loadDependency=function(e,n,t){i[e].model=n,i[e].tracker=t,i[e].loaded=!0,r.loaded.dispatch(e,n),t?(t.setParent(r,e),t.isReady()?r.readyDependency(e):i[e].ready=!1):r.readyDependency(e)},this.readyDependency=function(e){i[e].ready=!0,r.readied.dispatch(e,i[e].model),n()&&(r.ready.unlock(),o&&o.readyDependency(a,t,r))},this.setMainModel=function(e){t=e},this.setParent=function(e,n){o=e,a=n},this.get=function(e){var n=i[e];if(n)return n.model},this.reset=function(){r.ready.lock();for(var e in i)r.removeDependency(e)},this.dispose=function(){r.ready.dispose(),H.signalClear(r.loaded),H.signalClear(r.readied);for(var e in i)r.removeDependency(e)}}function E(e,n,t){if(8==e.nodeType){var r=e.nodeValue.match(/model-bind[\s]*:[\s]*\"[\s\S]*?\"/);if(r){var i=r[0].match(/\"[\s\S]*?\"/);if(i){var o=i[0].indexOf('"')+1,a=i[0].indexOf('"',o),s=i[0].substring(o,a),u='"'+s;s&&(u+=", "),u+=t+": '"+n+"'\"",e.nodeValue=e.nodeValue.replace(i[0],u)}}else e.nodeValue+='model-bind: "'+t+": '"+n+"'\""}else{var c=!1;if(e.attributes)for(var d=0;d<e.attributes.length;d++){var l=e.attributes[d];l.specified&&"model-bind"==l.name&&(l.value&&(l.value+=", "),l.value+=t+": '"+n+"'",c=!0)}if(!c)var l=e.setAttribute("model-bind",t+": '"+n+"'")}}function $(t,r,i){var o=e.unwrap(t()),a=r.get("virtual")||!1,s=function(){if(a){for(var e=[],t=0,r=0;r<i.$componentTemplateNodes.length;r++){var s=i.$componentTemplateNodes[r];8==s.nodeType&&s.nodeValue.trim().toUpperCase()==o.toUpperCase()&&t++,t>0&&(e.push(s),8==s.nodeType&&s.nodeValue.trim().toUpperCase()=="/"+o.toUpperCase()&&t--)}return{nodes:e}}if(H.isDefined(o)){var u=n(i.$componentTemplateNodes).filter(o);return{nodes:u}}return{nodes:i.$componentTemplateNodes}};return s}function O(e){var n=e.$parentContext,t=e.$data,r=n.extend({$containerContext:e,$container:t.model});return r}function D(t,r,i){var o=e.unwrap(t()),a=r.get("virtual")||!1,s=function(){if(a){for(var e=0;e<i.$componentTemplateNodes.length;e++){var t=i.$componentTemplateNodes[e];if(8==t.nodeType&&t.nodeValue.trim().toUpperCase()==o.toUpperCase())return!0}return!1}return n(i.$componentTemplateNodes).filter(o).length>0};return s}function j(){function t(e){var n,t=h.name();if(!t)return{index:0};n=t.split("/");for(var r,i=e.split("/"),o=0;o<i.length;o++){if(n[o]!=i[o])return{index:o,fullName:r};r=r?r+"/"+n[o]:n[o]}return{index:i.length,fullName:r}}function o(){}function a(e,n,t,r){t.setMainModel(n),t.ready.force(),h.trackers[e]=t,h.controllers[e]=n,r&&(n.parent=r)}function s(e,n,t){var r=[];if(e&&(r=e.split("/")),n.index<r.length){var i,u=r[n.index],c=n.fullName;c&&h.controllers[c]&&(i=h.controllers[c]);var d=n.fullName?n.fullName+"/"+u:u,l={index:n.index+1,fullName:d};H.controllerProvider(d,function(n){var r=new C,o=new n(i,r);a(d,o,r,i),s(e,l,t)},function(n){var r=new C,u=new o(i,r);a(d,u,r,i),s(e,l,t)})}else t()}function u(e){var n=h.name(),t=[];n&&(t=n.split("/"));for(var r=e.fullName,i=e.index;i<t.length;i++){var o=t[i];r=r?r+"/"+o:o;var a=h.controllers[r],s=h.trackers[r];a&&H.isFunction(a.dispose)&&a.dispose(),s&&s.dispose(),delete h.controllers[r],delete h.trackers[r]}}function c(e){var n=h.name(),t=[];n&&(t=n.split("/"));for(var r=e.fullName,i=e.index;i<t.length;i++){var o=t[i];r=r?r+"/"+o:o;var a=b[r],s=h.controllers[r];for(var u in a)s.outlets[u]="empty"}}function d(n,t){var r=[];n&&(r=n.split("/"));for(var i=t.fullName,o=t.index;o<r.length;o++){var a=r[o];i=i?i+"/"+a:a;var s=h.controllers[i],u=b[i];s.outlets||(s.outlets={});for(var c in u)s.outlets[c]=u[c];var d=y[i];if(s.params||(s.params={}),d)if(H.isArray(d))for(var l=0;l<d.length;l++)s.params[d[l]]=e.observable();else{if(!H.isObject(d))throw new Error("The parameters of '"+i+"' must be an object or array");for(var a in d)s.params[a]=e.observable(d[a])}}}function l(e,n){var t,r=[];n&&(r=n.split("/"));for(var i=0;i<r.length;i++){var o=r[i];if(t=t?t+"/"+o:o,y[t]){var a=h.controllers[t];if(a&&a.params)for(var s in a.params)if(H.isDefined(e[s])){var u=e[s];a.params[s](u)}}}}function f(e,n){var t=[];e&&(t=e.split("/"));for(var r=n.fullName,i=n.index;i<t.length;i++){var o=t[i];r=r?r+"/"+o:o;var a=h.controllers[r];a&&a.init&&a.init()}}function p(e,n){w[e]=m.addRoute(n,function(n){var r=t(e);c(r),u(r),s(e,r,function(){d(e,r),l(n,e),f(e,r),h.name(e);var t=v.getPageConfig(e);t.module?h.module(t.module):H.undefine(h.module),v.routed.dispatch(e)})})}var v=this,m=r.create();m.normalizeFn=r.NORM_AS_OBJECT,m.ignoreState=!0;var h={name:e.observable(),module:e.observable(),controllers:{},trackers:{}};this.current=h.name,this.currentModule=h.module,this.currentHash=e.observable(),this.routed=H.signal();var b={},g={},w={},y={},x={};this.pages=function(e,t,r){if(r)for(var i in e)for(var o=i.split("/"),a="",s=0;s<o.length;s++){var u=o[s];""!=a&&(a+="/"),a+=u,b[a]||(x[a]=r)}if(n.extend(b,e),t){n.extend(y,t);for(var i in t)H.isDefined(b[i])||(b[i]={})}},this.getPageConfig=function(e){var n={};return b[e]&&(n.name=e,n.outlets=b[e]),g[e]&&(n.route=g[e]),y[e]&&(n.param=y[e]),x[e]&&(n.module=x[e]),n},this.mapRoute=function(e){for(var n in e){var t=e[n];p(n,t),g[n]=t}},this.parse=function(e){v.currentHash(e),m.parse(e)},this.hash=function(e,n){var t=w[e];if(t)return t.interpolate(n)},this.activateHasher=function(e){function n(n,t){H.isDefined(e)?e(n,t):v.parse(n)}i.initialized.add(n),i.changed.add(n),i.init()},e.bindingHandlers.outlet={init:function(n,t,r,i,o){function a(e){var n=[];e&&(n=e.split("/"));for(var t,r,i,o,a,l=0;l<n.length;l++){var f=n[l];r=r?r+"/"+f:f;var t=h.controllers[r],p=h.trackers[r];for(var v in t.outlets)v==u&&(i=t.outlets[v],o=t,a=p)}if(i){if(i!=c().name||o!=s){var m={name:i};o&&o.sendParameters?m.params=o.sendParameters(u,i):m.params={},a.addDependency(u),s=o,c(m),d&&window.scrollTo(0,0)}}else s="",c({name:"empty"})}var s,u=e.unwrap(t()),c=e.observable({name:"empty"}),d=r.get("resetScroll")||!0,l=h.name.subscribe(a);a(h.name()),e.utils.domNodeDisposal.addDisposeCallback(n,function(){l.dispose(),s=""}),E(n,u,"exportToController");var f=function(){return c};return e.bindingHandlers.component.init(n,f,r,i,o)}},e.virtualElements.allowedBindings.outlet=!0,e.bindingHandlers.exportToController={init:function(n,t,r,i,o){var a=e.unwrap(t()),s=[],u=h.name();u&&(s=u.split("/"));for(var c,d,l,f,p,v=0;v<s.length;v++){var m=s[v];d=d?d+"/"+m:m;var c=h.controllers[d],b=h.trackers[d];for(var g in c.outlets)g==a&&(l=c.outlets[g],f=c,p=b)}if(f&&p){var w=o.$childContext.$data.getModel(),y=o.$childContext.$data.getImports();p.loadDependency(a,w,y)}f="",p=""}},e.virtualElements.allowedBindings.exportToController=!0}function T(n,t){t||(t=this),t.validationReset();for(var r in t.validationConfig){var i=t.validationConfig[r];if(e.validators[r]){var o=e.validators[r](t,i);if(!o.validate(n))return!1}}return!0}function S(e,t,r,i,o){var a=t(),s=!1;if(H.isArray(a)){for(var u=0;u<a.length;u++)if(!a[u].hasError()){s=!0;break}}else s=a.hasError();s?n(e).addClass("has-error"):n(e).removeClass("has-error")}function N(){var e=this,n={};this.get=function(t){if(n[t])return n[t];var r=require("service!"+t),i=new r(e);return n[t]=i,i}}var H={};H.started=!1,H.ajaxErrorHandlers={},H.formatters={},H.isDefined=function(e){return"undefined"!=typeof e},H.isString=function(e){return"string"==typeof e||e instanceof String},H.isInt=function(e){return Number(e)===e&&e%1===0},H.canBeInt=function(e){return Number(e)==e&&e%1===0},H.isNumeric=function(e){return"number"==typeof e},H.isDecimal=function(e){return e===Number(e)&&e%1!==0},H.isArray=function(e){return n.isArray(e)},H.isObject=function(e){return!(null===e||"object"!=typeof e||e instanceof Array)},H.isFunction=function(e){return null!==e&&"function"==typeof e},H.isDate=function(e){return e instanceof Date},H.isValidDate=function(e){return!!H.isDate(e)&&!isNaN(e.getTime())},H.clone=function(e){return n.extend(!0,{},e)},H.cloneObservable=function(e){return t.fromJS(t.toJS(e))},H.cloneMixed=function(n){var t=new n.constructor;for(var r in n){var i;e.isObservable(n[r])?(i=n[r](),H.isObject(i)?t[r]=e.observable(H.cloneMixed(i)):t[r]=e.observable(i)):(i=n[r],H.isObject(i)?t[r]=H.cloneMixed(i):t[r]=i)}return t},H.call=function(n){if(e.isObservable(n)&&(n=n()),e.isObservable(n))throw new Error("Callback can not be an observable");if(H.isFunction(n)){var t=Array.prototype.slice.call(arguments,1);return n.apply(null,t)}},H.makeDate=function(e,n){if(H.isDate(e)||(e=new Date(e)),!H.isValidDate(e)){if(!n)return;e=new Date}return e},H.toShortISO=function(e){if(H.isDate(e))return e.toISOString().slice(0,10)},H.clear=function(t){n.each(t,function(n,t){e.isObservable(t)?t(void 0):t=void 0})},H.undefine=function(n){e.isObservable(n)?n(void 0):n=void 0},H.formatString=function(){var e=Array.prototype.slice.call(arguments),n=e[0];if(2==e.length&&H.isString(e[0])&&H.isObject(e[1])){var t=e[1],r=n;for(var i in t)r=u(r,"{"+i+"}",t[i]);return r}for(var o=1;o<e.length;o++)n=u(n,"{"+(o-1)+"}",e[o]);return n},H.extends=function(e,n){e.prototype=new n,e.prototype.constructor=e,e.super=n.prototype},e.associativeObservable=function(n){function t(){return arguments.length>0?(r(arguments[0]),this):r()}var r=e.observable(n);return t.add=function(e,n){var t=r();t||(t={}),t[e]=n,r(t)},t.get=function(e){var n=r();if(n){if(H.isDefined(n[e]))return n[e];throw new Error("The specified key does not exists")}throw new Error("The specified key does not exists")},t.exists=function(e){var n=r();return!(!n||!H.isDefined(n[e]))},t.update=function(e,n){var t=r();if(t){if(H.isDefined(t[e])){var i=t[e];return t[e]=n,r(t),i}throw new Error("The specified key does not exists")}throw new Error("The specified key does not exists")},t.remove=function(e){var n,t=r();return t&&H.isDefined(t[e])&&(n=t[e],delete t[e],r(t)),n},t.array=e.pureComputed(function(){var e=r(),n=[];if(e)for(var t in e){var i=e[t];n.push(i)}return n}),t.each=function(e){var n=r();if(n)for(var t in n)e(t,n[t])},t.subscribe=function(e){return r.subscribe(e)},t},e.observable.fn.refresh=function(){var e=this();H.undefine(this),this(e)},e.isObservableArray=function(n){return!(!e.isObservable(n)||void 0===n.indexOf)},e.isComputed=function(n){return null!==n&&void 0!==n&&void 0!==n.__ko_proto__&&(n.__ko_proto__===e.dependentObservable||e.isComputed(n.__ko_proto__))},e.mapToJS=function(e){return t.toJS(t.fromJS(e))},e.mapFromJS=function(e){return t.fromJS(t.toJS(e))};var B=e.bindingProvider.prototype.parseBindingsString,M=/^\$\{(.+)\}$/;e.bindingProvider.prototype.parseBindingsString=function(e,n,t,r){var i=e.match(M);return i?c.call(this,i[1],n,t,r):B.apply(this,arguments)},e.bindingHandlers.href={update:function(n,t,r,i,o){var a=e.unwrap(t()),s=e.unwrap(r.get("params")),u=function(){return{href:"#"+H.routing.hash(a,s)}};return e.bindingHandlers.attr.update(n,u,r,i,o)}},e.bindingHandlers.onBind={init:function(n,t,r,i,o){var a=e.unwrap(t());a(n,i,o)}},e.bindingHandlers.format={init:function(n,t,r){var i=l(t,r),o=r.get("bindTo")||"text",a={};a[o]=i,e.applyBindingsToNode(n,a)}},e.bindingHandlers.waitReady={init:function(n,t,r,i,o){function a(e){e==s&&(u(!0),i.imports.readied.remove(a))}var s=e.unwrap(t());if(!H.isString(s))throw new Error("The binding must be an string with the property name of the imported dependency");var u=e.observable(!1);return i&&i.imports&&i.imports.readied&&i.imports.readied.add(a),e.bindingHandlers.if.init(n,u,r,i,o)}},e.virtualElements.allowedBindings.waitReady=!0,H.signal=function(){return new o.Signal},H.signalClear=function(e){e.removeAll()},H.lock=function(e){return new f(e||!1)},H.wait=function(e,n){e.call(n)},H.redirect=function(e){return window.location.href=e,!0},H.redirectHash=function(e,n){var t=H.routing.hash(e,n);H.redirect("#"+t)},H.getParam=function(e){var n=void 0,t=[];return location.search.substr(1).split("&").forEach(function(r){t=r.split("="),t[0]===e&&(n=decodeURIComponent(t[1]))}),n},H.replaceAndBind=function(t,r,i){e.cleanNode(n(t).get(0)),n(t).empty(),n(t).html(r),e.applyBindings(i,n(t).get(0))},H.htmlEncode=function(e){return e?n("<div />").text(e).html():""},H.htmlDecode=function(e){return e?n("<div />").html(e).text():""},H.limitText=function(e,n){return H.isInt(n)?n<6&&(n=6):n=6,H.isString(e)?(e.length>n&&(e=e.substr(0,n-3)+"..."),e):""},H.setCookie=function(e,n,t){var r=new Date;if(void 0!==t){r.setTime(r.getTime()+1e3*t);var i="expires="+r.toUTCString();document.cookie=e+"="+n+"; "+i}else document.cookie=e+"="+n+"; "},H.getCookie=function(e){e+="=";for(var n=document.cookie.split(";"),t=0;t<n.length;t++){for(var r=n[t];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return""},H.clearCookie=function(e){H.setCookie(e,"",-1)},H.loadCss=function(e){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,document.getElementsByTagName("head")[0].appendChild(n)};var A=!1;H.ajaxConfig={contentType:"application/json",dataType:"json",async:!0,cache:!1,authorization:{has:function(){return!0},configAuthorization:function(e){return e},authorize:function(e,n){n(!0)}}},H.ajax=function(e,t,r,i,o,a){function s(){l=l.authorization.configAuthorization(l),n.ajax(l)}var u=a||{},c=i||{};if(!e)throw new Error("Must specify the target URL");var d;H.isFunction(c)?d=c:H.isObject(c)&&(d=c.onSuccess);var l={url:e,type:t||"GET",data:r,success:d,complete:function(){H.isDefined(c.onComplete)&&c.onComplete()},error:function(n,t,r){var i=!1;if(H.isDefined(c.onError)&&(i=c.onError(n,t,r)),!i)for(var o in H.ajaxErrorHandlers)if(H.ajaxErrorHandlers[o](e,n,t,r)){i=!0;break}}};l=n.extend(l,H.ajaxConfig),l=n.extend(l,u),!A&&o?l.authorization.has()?s():(A=!0,l.authorization.authorize(function(e){A=!1,e&&s()})):n.ajax(l)},H.onError=function(e,n){return!1},H.errorSignal=H.signal(),Object.setPrototypeOf(p,Error),p.prototype=Object.create(Error.prototype),p.prototype.name="BindingError",p.prototype.message="",p.prototype.constructor=p,window.onerror=function(e,n,t,r,i){var o,s,u=H.onError(e,i);return H.isObject(u)?(u.handled&&(s=u.handled),u.stack&&(o=u.stack)):s=u,a.fromError(i).then(function(e){H.errorSignal.dispatch(i,e),o&&o(e)}),s},requirejs.onError=function(e){throw e},e.onError=function(e){throw e};var q=function(){var n=new e.bindingProvider;this.nodeHasBindings=n.nodeHasBindings,this.getBindings=function(e,t){var r;try{r=n.getBindings(e,t)}catch(n){var i=t.$component;throw new p("Binding Error: "+n.message,i,e,n)}return r}};return e.bindingProvider.instance=new q,H.modules=e.associativeObservable({}),H.start=function(n){H.started||(e.applyBindings(n),H.started=!0)},H.module=function(e,n,t){if(!H.isDefined(e))throw new Error("Must specify the module configuration. You can define 'module' as dependency and pass that value in this parameter");var r=e.id.substring(0,e.id.indexOf("/")),i=e.uri.substring(0,e.uri.lastIndexOf("/"));if(H.modules.exists(r))return H.modules.get(r);if(n||(n={}),H.isDefined(n.require)&&require(n.require),n.components)for(var o in n.components){var a=n.prefix+"-"+o,s=r+"/"+n.components[o];H.registerComponent(a,s)}if(n.namespaces&&(n.prefix?v(n.prefix,n.namespaces,r):v("",n.namespaces,r)),H.isArray(n.css))for(var u=0;u<n.css.length;u++)H.loadCss(i+"/"+n.css[u]);n.pages&&(n.params?H.routing.pages(n.pages,n.params,r):H.routing.pages(n.pages,void 0,r)),n.routes&&H.routing.mapRoute(n.routes),n.services&&H.services(n.services);var c;return t&&(c=new t(r,i,e)),H.modules.add(r,{name:r,path:i,info:e,config:n,main:c}),H.modules.get(r)},H.component=function(e,n){function t(n){var t,r,i={},o=new C;e&&!t&&(r=H.serviceContext(n),t=new e(n,i,o,r),o.setMainModel(t),o.ready.force(),o&&H.isFunction(o.initComponent)&&o.initComponent(),i.model=t,i.imports=o,i.context=r),this.getModel=function(){return t},this.getScope=function(){return i},this.getImports=function(){return o},this.dispose=function(){t&&t.dispose&&t.dispose(),i&&i.dispose&&i.dispose(),o&&o.dispose(),delete t,delete i,delete o}}return H.isDefined(n)||(n=e,H.undefine(e)),e?{template:n,viewModel:t,modelType:e}:{template:n}},H.parameters=function(n,t,r){if(!H.isObject(n))throw new Error("You must specify a parameters config object");if(!H.isObject(t))throw new Error("You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.");if(!H.isDefined(r))throw new Error("You must specify the viewmodel of the component in wich to load the parameters.");H.isArray(r)||(r=Array(r));for(var i in n)for(var o=0;o<r.length;o++){var a=r[o];if(a[i]=n[i],H.isDefined(t[i]))if(e.isObservable(a[i])&&e.isObservable(t[i]))a[i]=t[i];else if(e.isObservable(a[i])&&!e.isObservable(t[i]))a[i](t[i]);else if(!e.isObservable(a[i])&&e.isObservable(t[i]))a[i]=t[i]();else if(!e.isObservable(a[i])&&!e.isObservable(t[i]))if(H.isFunction(a[i])){if(H.isFunction(t[i]))a[i]=t[i];else if(H.isDefined(t[i]))throw new Error("The parameter "+i+" must be a callback.")}else H.isObject(n[i])&&H.isObject(t[i])?H.parameters(n[i],t[i],a[i]):a[i]=t[i]}},H.repackParameters=function(e,t){var r={},i=new Array,o={};if(H.isArray(e))i=e;else if(H.isObject(e)){if(!(H.isArray(e.export)||H.isString(e.export)||H.isObject(e.send)))throw new Error("The params object must be an array of values to export, or an object with at least an export or send property, or a string with the name of the property to export");H.isDefined(e.export)&&(i=e.export),H.isObject(e.send)&&(o=e.send)}else{if(!H.isString(e))throw new Error("The params object must be an array of values to export, or an object with at least an export or send property, or a string with the name of the property to export");i=e}if(H.isArray(i))for(var a=0;a<i.length;a++){var s=i[a];H.isDefined(t[s])&&(r=n.extend(r,t[s]))}else H.isDefined(t[i])&&(r=n.extend(r,t[i]));for(var s in o)r[s]=o[s];return r},H.inject=function(n,t,r){if(H.isDefined(n)&&H.isDefined(t))for(var i in n)if(H.isDefined(t[i])){var o;o=e.isObservable(n[i])?n[i]():n[i],e.isObservable(t[i])?r&&H.isObject(t[i]())?H.inject(o,t[i](),!0):t[i](o):r&&H.isObject(t[i])?H.inject(o,t[i],!0):t[i]=o}},H.emptyTemplate=function(e){return e?"<!-- quark-component --><!-- /quark-component -->":"<quark-component></quark-component>"},H.registerComponent=function(n,t){e.components.register(n,{require:t})},H.registerComponents=function(e){v("",e)},e.components.register("empty",{template:" "}),H.onNamespace=function(e,n){var t=this,r=e;return this.register=function(e,n){return H.registerComponent(r+"-"+e,n),t},this.namespace=function(e){return new H.onNamespace(r+"-"+e,t)},this.endNamespace=function(){return n},t},H.behaviour=new m,e.components.register("quark-component",{template:"<!-- ko componentScope --><!-- /ko --><!-- ko modelBinder --><!-- /ko -->"}),e.bindingHandlers.componentScope={init:function(n,t,r,i,o){var a=h(o),s=b(o);return e.bindingHandlers.template.init(n,a,r,s.$data,s)},update:function(n,t,r,i,o){var a=h(o),s=b(o);return e.bindingHandlers.template.update(n,a,r,s.$data,s)}},e.virtualElements.allowedBindings.componentScope=!0,e.bindingHandlers.modelBinder={init:function(n,t,r,i,o){var a=x(n),s=k(o);return e.bindingHandlers.template.init(n,a,r,o.$parent,s)},update:function(n,t,r,i,o){var a=x(n),s=k(o);return e.bindingHandlers.template.update(n,a,r,o.$parent,s)}},e.virtualElements.allowedBindings.modelBinder=!0,H.tracker=function(){return new C},e.bindingHandlers.import={init:function(e,n,t,r,i){var o,a,s=n();if(r&&r.imports&&r.model)o=r.model,a=r.imports;else{if(!r||!r.$imports)throw new Error("The import binding can only import to Quark components or objects with a propery $imports that contains a Tracker object");o=r,a=r.$imports}a.addDependency(s),E(e,s,"export")}},e.virtualElements.allowedBindings.import=!0,e.bindingHandlers.export={init:function(n,t,r,i,o){var a;a=e.unwrap(t());var s,u;if(i&&i.imports&&i.model)s=i.model,u=i.imports;else{if(!i||!i.$imports)throw new Error("The import binding can only import to Quark components or objects with a propery $imports that contains a Tracker object");s=i,u=i.$imports}var c;if(!H.isString(a))throw new Error("The value of the vm value must be an string with the name of the property where quark must load the viewmodel of the nested component");if(c=a,u){var d=o.$childContext.$data.getModel(),l=o.$childContext.$data.getImports();u.loadDependency(c,d,l)}}},e.virtualElements.allowedBindings.export=!0,e.bindingHandlers.content={init:function(n,t,r,i,o){var a=$(t,r,o),s=O(o);return e.bindingHandlers.template.init(n,a,r,o.$parent,s)},update:function(n,t,r,i,o){var a=$(t,r,o),s=O(o);return e.bindingHandlers.template.update(n,a,r,o.$parent,s)}},e.virtualElements.allowedBindings.content=!0,e.bindingHandlers.hasContent={init:function(n,t,r,i,o){var a=D(t,r,o);return e.bindingHandlers.if.init(n,a,r,o,o)}},e.virtualElements.allowedBindings.hasContent=!0,e.bindingHandlers.hasNotContent={init:function(n,t,r,i,o){var a=D(t,r,o);return e.bindingHandlers.ifnot.init(n,a,r,o,o)}},e.virtualElements.allowedBindings.hasNotContent=!0,H.controllerProvider=function(e,n,t){var r=this,i="";this.controllersBase="controllers";var o=H.routing.getPageConfig(e);i=o.module?o.module+"/"+r.controllersBase+"/"+e+".controller":r.controllersBase+"/"+e+".controller",require([i],function(e){n(e)},function(e){t()})},H.routing=new j,e.bindingHandlers.namespace={init:function(n,t,r,i,o){var a=t(),s=r.get("alias");if(!H.isString(a))throw new Error("Must specify namespace as string. The binding must be in the form: namespace: 'namespace', alias: 'alias'");if(!H.isString(s))throw new Error("Must specify alias to namespace as string. The binding must be in the form: namespace: 'namespace', alias: 'alias'");var u=a.toLowerCase();if(s=s.toLowerCase(),o){var c;c=o.namespaces?{namespaces:o.namespaces}:{namespaces:{}},c.namespaces[s]=u;var d=o.extend(c);return e.applyBindingsToDescendants(d,n),{controlsDescendantBindings:!0}}}},e.virtualElements.allowedBindings.namespace=!0,e.bindingProvider.instance.preprocessNode=function(n){if(8==n.nodeType){var t=n.nodeValue.match(/^\s*(quark-component[\s\S]+)/);if(t)return n.data=" ko component: { name: 'quark-component' } ",n;var t=n.nodeValue.match(/^\s*(\/quark-component[\s\S]+)/);if(t)return n.data=" /ko ",n}if(n&&n.nodeName&&e.components.isRegistered(n.nodeName.toLowerCase())&&n.attributes.virtual){var r=n.attributes.params,i=n.attributes["data-bind"],o=n.attributes["model-bind"],a=" ko component: { name: '"+n.nodeName.toLowerCase()+"' ";if(r){var s=/^\$\{(.+)\}$/,u=r.value.match(s);a+=u?", params: "+u[1]+" ":", params: { "+r.value+" } "}else a+=", params: {}";a+=" } ",i&&(a+=", "+i.value+" "),o&&(a+=', model-bind: "'+o.value+'"');var c=document.createComment(a),d=document.createComment(" /ko ");for(n.parentNode.insertBefore(d,n.nextSibling),n.parentNode.replaceChild(c,n);n.childNodes.length>0;)c.parentNode.insertBefore(n.childNodes[0],d);return[c,d]}},e.components.getComponentNameForNode=function(n){var t=n.tagName&&n.tagName.toLowerCase();if(e.components.isRegistered(t))return t;if(t.indexOf(":")!==-1){var r=t.split(":"),i=r[0],o=r[1],a=e.contextFor(n);if(a&&H.isObject(a.namespaces)&&a.namespaces[i]){var s=a.namespaces[i],u=s+"-"+o;if(e.components.isRegistered(u))return u}}return null},e.validators={},e.validate=function(n,t){var r=!0;for(var i in n){var o=n[i];e.isObservable(o)&&o.validatable&&(o.validate(t)||(r=!1))}return r},e.unsubscribeValidation=function(n){for(var t in n){var r=n[t];e.isObservable(r)&&r.validatable&&r.validationSubscription&&(r.validationSubscription.dispose(),delete r.validationSubscription)}},e.validationReset=function(n){for(var t in n){var r=n[t];e.isObservable(r)&&r.validatable&&r.validationReset()}},e.observable.fn.validation=function(n,t){return this.validatable=n,this.validationConfig=t,this.hasError=e.observable(),this.validationMessage=e.observable(),this},e.observable.fn.validationReset=function(){this.validatable&&(this.hasError(!1),this.validationMessage(""))},e.observable.fn.validate=function(e){return e&&!this.validationSubscription&&(this.validationSubscription=this.subscribe(T,this)),T(this(),this)},e.bindingHandlers.formGroupError={init:function(e,n,t,r,i){S(e,n,t,r,i)},update:function(e,n,t,r,i){S(e,n,t,r,i)}},e.bindingHandlers.fieldError={init:function(n,t,r,i,o){var a=function(){return t().validationMessage};e.bindingHandlers.text.init(n,a,r,i,o)},update:function(n,t,r,i,o){var a=function(){return t().hasError},s=function(){return t().validationMessage};e.bindingHandlers.visible.update(n,a,r,i,o),e.bindingHandlers.text.update(n,s,r,i,o)}},H.services=function(e){require.config({config:{services:e}})},H.serviceContext=function(e){return e&&e.context&&e.context instanceof N?e.context:new N},"function"==typeof define&&define.amd&&define("knockout",function(){return e}),H});
