!function(e,n){"function"==typeof define&&define.amd?define(["knockout","jquery","knockout-mapping","accounting-js","crossroads","hasher","blockui"],n):(e.komapping=ko.mapping,e.$$=n(e.ko,e.$,e.komapping,e.accounting,e.crossroads,e.hasher))}(this,function(ko,$,komapping,accounting,crossroads,hasher){function applyBehaviour(e,n){if(!$$.isString(n))throw"The behaviour name must be an string. If you specified an array check that all elements are valid behaviour names";if(!behaviours[n])throw"The are no behaviours loaded with the name "+n+".";behaviours[n](e),$$.isDefined(e.behaviours)||(e.behaviours={}),e.behaviours[n]=!0}function createComponentShadyDomAccesor(e){var n=function(){return{nodes:e.$componentTemplateNodes}};return n}function createModelExporterAccessor(e,n,t,i,o){var r=function(){for(var n=Array(),t=e.parentNode.parentNode,i=0;i<t.attributes.length;i++){var o=t.attributes[i];o.specified&&0===o.name.indexOf("qk-")&&(n.push(document.createComment("ko "+o.name.replace("qk-","")+": "+o.value)),n.push(document.createComment("/ko")))}return{nodes:n,"if":n.length>0}};return r}function injectBinding(e,n,t){var i=ko.unwrap(e()),o=t.$child,r=i;$$.isObject(i)&&$$.isDefined(i.data)&&$$.isDefined(i.target)&&(o=i.target,r=i.data),$$.inject(r,o)}function createContentAccesor(e,n,t,i,o){var r=ko.unwrap(n()),a=function(){return $$.isInt(r)?{nodes:o.$componentTemplateNodes.slice(r)}:$$.isDefined(r)?{nodes:$(o.$componentTemplateNodes).filter(r)}:{nodes:o.$componentTemplateNodes}};return a}function createHasContentAccesor(e,n,t,i,o){var r=ko.unwrap(n()),a=function(){return $(o.$componentTemplateNodes).filter(r).length>0};return a}function createPageAccessor(element,valueAccessor,allBindingsAccessor,viewModel,context){var name=ko.unwrap(valueAccessor()),newAccesor=function(){var current=$$.routing.current(),component,params;return $$.isArray(current.route.components[name])?(component=current.route.components[name][0],eval("params = {"+current.route.components[name][1]+"}")):(component=current.route.components[name],params=current),{name:ko.pureComputed(function(){return component}),params:params}};return newAccesor}function QuarkRouter(){function e(){var e=this;e.configuration={};var n;this.on=function(t,i){if(!$$.isString(t))throw"The page must be an string with the pattern of the pathname to match.";if(!$$.isDefined(i))throw"Must define a name for the routes on the page.";return e.configuration[i]={pattern:t,routes:{}},n=i,e},this.when=function(t,i,o){if($$.isDefined(i)||$$.isDefined(o)){if(!$$.isDefined(o)||!$$.isDefined(i))throw"Must define the hash, name and components parameters"}else o=t,i="",t="Any";if(!$$.isDefined(n))throw"You must define the location to where this route applies using the .on method before calling .when.";var r=n+"/"+i;return e.configuration[n].routes[i]={hash:t,components:o,fullName:r,name:i},e}}function n(e,n,i,o,r,a){var s=this,c=e.addRoute(r,function(e){t.current({route:s,location:location.pathname,params:e})});this.name=n,this.fullName=i,this.locationPattern=o,this.hash=r,this.components=a,this.parse=function(n){e.parse(n)},this.interpolate=function(e){return c.interpolate(e)}}var t=this;this.current=ko.observable(),this.configuration=[],this.routes=function(){return new e},this.configure=function(e){for(var i in e.configuration){var o=e.configuration[i],r=e.configuration[i].pattern,a=crossroads.create();a.normalizeFn=crossroads.NORM_AS_OBJECT,o.router=a;for(var s in o.routes)if(""!==s){var c,u=o.routes[s];c=u.components,$$.isDefined(o.routes[""])&&$.extend(c,o.routes[""].components);var d=new n(a,u.name,u.fullName,r,u.hash,c);u.route=d}}t.configuration=e.configuration},this.parse=function(e,n){$$.isDefined(n)||(n=e,e=window.location.pathname);for(var i in t.configuration){var o=t.configuration[i],r=RegExp(o.pattern);if(e.match(r))return o.router.parse(n)}},this.getRoute=function(e){var n=e.substr(0,e.indexOf("/")),i=e.substr(e.indexOf("/")+1);if(!i)throw new"You must specifiy route name in the form location/routeName.";return t.configuration[n]?t.configuration[n].routes[i]||console.warn("The route name specified as "+e+" was not found in the routing configuration for the "+n+" location."):console.warn("The location specified as "+e+" was not found in the routing configuration."),t.configuration[n]&&t.configuration[n].routes[i]?t.configuration[n].routes[i].route:void 0},this.hash=function(e,n){var i=t.getRoute(e);return i?i.interpolate(n):void 0},this.link=function(e,n,i){var o=t.getRoute(e);return o?(i||(i=o.locationPattern),i+"#"+o.interpolate(n)):void 0},this.listLocation=function(e){$$.isDefined(e)||(e=window.location.pathname);for(var n in t.configuration){var i=t.configuration[n],o=RegExp(i.pattern);if(e.match(o))return i.routes}},this.activateHasher=function(){function e(e,n){t.parse(e)}hasher.initialized.add(e),hasher.changed.add(e),hasher.init()}}function clearFields(e){for(var n in e)null===e[n]||void 0===e[n]?delete e[n]:"object"==typeof e[n]&&clearFields(e[n]);return e}function validateValue(e){this.validationReset();for(var n in this.validationConfig){var t=this.validationConfig[n];if(ko.validators[n]){var i=ko.validators[n](this,t);if(!i.validate(e))return this.parent&&this.parent.validationSummary.push({name:this.validatable,message:this.validationMessage()}),!1}}return!0}function setFormGroupErrorClass(e,n,t,i,o){var r=n(),a=!1;if($$.isArray(r))for(var s=0;s<r.length;s++)r[s].hasError()||(a=!0);else a=r.hasError();a?$(e).addClass("has-error"):$(e).removeClass("has-error")}var $$={};$$.isDefined=function(e){return"undefined"==typeof e?!1:!0},$$.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},$$.isInt=function(e){return Number(e)===e&&e%1===0},$$.isNumeric=function(e){return"number"==typeof e},$$.isDecimal=function(e){return e===Number(e)&&e%1!==0},$$.isArray=function(e){return $.isArray(e)},$$.isObject=function(e){return null===e||"object"!=typeof e||e instanceof Array?!1:!0},$$.isFunction=function(e){return null!==e&&"function"==typeof e?!0:!1},$$.isDate=function(e){return e instanceof Date?!0:!1},$$.isValidDate=function(e){return $$.isDate(e)?isNaN(e.getTime())?!1:!0:!1},$$.clone=function(e){return $.extend(!0,{},e)},$$.cloneObservable=function(e){return komapping.fromJS(komapping.toJS(e))},$$.cloneMixed=function(e){var n=new e.constructor;for(var t in e){var i;ko.isObservable(e[t])?(i=e[t](),$$.isObject(i)?n[t]=ko.observable($$.cloneMixed(i)):n[t]=ko.observable(i)):(i=e[t],$$.isObject(i)?n[t]=$$.cloneMixed(i):n[t]=i)}return n},$$.call=function(e){if(ko.isObservable(e)&&(e=e()),ko.isObservable(e))throw"Callback can not be an observable";if($$.isFunction(e)){var n=Array.prototype.slice.call(arguments,1);return e.apply(null,n)}},$$.makeDate=function(e,n){if($$.isDate(e)||(e=new Date(e)),!$$.isValidDate(e)){if(!n)return void 0;e=new Date}return e},$$.component=function(e,n){function t(n){var t,i={};e&&!t&&(t=new e(n,i)),this.getModel=function(){return t},this.getScope=function(){return i},this.dispose=function(){t&&t.dispose&&t.dispose(),i&&i.dispose&&i.dispose(),t=void 0,i=void 0}}return $$.isDefined(n)||(n=e,e=void 0),e?{template:n,viewModel:t}:{template:n}},$$.config=function(e,n,t){if(!$$.isObject(e))throw"You must specify a config object";if(!$$.isObject(n))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!$$.isDefined(t))throw"You must specify the viewmodel of the component in wich to load the configuration.";$$.isArray(t)||(t=Array(t));for(var i in e)for(var o=0;o<t.length;o++){var r=t[o];$$.isDefined(r.config)||(r.config={}),$$.isDefined(r.config[i])&&console.warn("There is already a config property named "+i+" in the target component. The property will be replaced."),r.config[i]=e[i],ko.isObservable(r.config[i])&&console.warn("Property "+i+" should not be observable. The configuration parameters should be static, if you want the object to react to parameter changes use the parameters method."),$$.isDefined(n[i])&&(ko.isObservable(n[i])?r.config[i]=n[i]():r.config[i]=n[i])}},$$.parameters=function(e,n,t){if(!$$.isObject(e))throw"You must specify a parameters config object";if(!$$.isObject(n))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!$$.isDefined(t))throw"You must specify the viewmodel of the component in wich to load the parameters.";$$.isArray(t)||(t=Array(t));for(var i in e)for(var o=0;o<t.length;o++){var r=t[o];if($$.isDefined(r[i])&&console.warn("There is already a property named "+i+" in the target component. It will be replaced with the specified parameter."),r[i]=e[i],$$.isDefined(n[i]))if(ko.isObservable(r[i])&&ko.isObservable(n[i]))ko.isComputed(r[i])||(r[i]=n[i]);else if(ko.isObservable(r[i])&&!ko.isObservable(n[i]))r[i](n[i]);else if(!ko.isObservable(r[i])&&ko.isObservable(n[i]))r[i]=n[i]();else if(!ko.isObservable(r[i])&&!ko.isObservable(n[i]))if($$.isFunction(r[i])){if($$.isFunction(n[i]))r[i]=n[i];else if($$.isDefined(n[i]))throw"The parameter "+i+" must be a callback."}else r[i]=n[i]}},$$.inject=function(e,n,t){if($$.isDefined(e)&&$$.isDefined(n))for(var i in e)if($$.isDefined(n[i])){var o;o=ko.isObservable(e[i])?e[i]():e[i],ko.isObservable(n[i])?t&&$$.isObject(n[i]())?$$.inject(n[i](),o):n[i](o):t&&$$.isObject(n[i])?$$.inject(n[i],o):n[i]=o}};var behaviours={};return $$.behaviour=function(e,n){if($$.behaviour[e]&&console.warn("There was already a behaviour loaded with the name "+e+". It will be replaced with the new one."),!$$.isString(e))throw"The behaviour name must be an string.";if(!$$.isFunction(n))throw"The behaviour must be a function that takes an object as a parameter an applies the new functionality to it.";behaviours[e]=n},$$.behave=function(e,n){if(!$$.isObject(e))throw"You must specifify a valid object to apply the behaviour.";if($$.isArray(n))for(var t=0;t<n.length;t++)applyBehaviour(e,n[t]);else{if(!$$.isString(n))throw"The behaviour name must be an string or an array of strings.";applyBehaviour(e,n)}},$$.hasBehaviour=function(e,n){if(!$$.isObject(e))throw"You must specifify a valid object to check the behaviour.";if(!$$.isString(n))throw"The behaviour name must be an string.";return $$.isDefined(e.behaviours)&&$$.isDefined(e.behaviours[n])?!0:!1},ko.computedParameter=function(e,n,t){return ko.isObservable(e)||(e=ko.observable(e)),ko.computed({read:function(){return n.read(e)},write:function(t){return n.write(e,t)}},t)},ko.components.register("quark-component",{template:"<!-- ko componentShadyDom --><!-- /ko --><!-- ko modelExporter --><!-- /ko -->"}),ko.bindingHandlers["import"]={init:function(e,n,t,i,o){var r=i,a=n();if(!$$.isString(a))throw"The import value must be an string with the name of the property to create on the parent object";$$.isObject(r.tracking)||(r.tracking={childs:{}}),r.tracking.childs[a]={},r.tracking.childs[a].load=function(e,n){r[e]=n,r.tracking.childs[e].loaded=!0,$$.isDefined(r.loaded)&&r.loaded(e,n),$$.isDefined(n.tracking)?(r.tracking.childs[e].ready=!1,n.tracking.parent=r,n.tracking.parentState=r.tracking.childs[e]):(r.tracking.childs[e].ready=!0,$$.isDefined(r.readied)&&r.readied(e,n),$$.isDefined(n.ready)&&n.ready());for(var t in r.tracking.childs)if(!r.tracking.childs[t].loaded||!r.tracking.childs[t].ready)return;$$.isFunction(r.ready)&&r.ready(),$$.isDefined(r.tracking)&&$$.isDefined(r.tracking.parent)&&(r.tracking.parentState.ready=!0,$$.isDefined(r.tracking.parent.readied)&&r.tracking.parent.readied(e,n),r.tracking.parent.childReady())},r.tracking.childs[a].loaded=!1,r.tracking.childReady=function(){for(var e in r.tracking.childs)if(!r.tracking.childs[e].ready)return;$$.isFunction(r.ready)&&r.ready(),$$.isDefined(r.parent)&&(r.traking.parentState.ready=!0,r.tracking.parent.childReady())},r[a]={},e.setAttribute("qk-export","'"+a+"'")}},ko.bindingHandlers["export"]={init:function(e,n,t,i,o){var r;r=ko.unwrap(n());var a;if($$.isString(r)?a=r:$$.isObject(r)&&($$.isString(r.property)&&(a=r.property),$$.isDefined(r.model)&&(i=r.model)),!$$.isString(a))throw"The value of the vm value must be an string with the name of the property where quark must load the viewmodel of the nested component";if(!$$.isDefined(i.tracking))throw"The specified object doesn´t have the tracking.childs property. This usually is because you don´t used the function .components to set the properties where the vm binding has to set the viewmodel";if(!$$.isDefined(i.tracking.childs))throw"The specified object doesn´t have the tracking property. This usually is because you don´t used the function .components to set the properties where the vm binding has to set the viewmodel";if(!$$.isDefined(i.tracking.childs[a]))throw"The specified object doesn´t have a property named "+r+". Verify that the object has a property defined with the .components method with the name defined in the vm binding.";i.tracking.childs[a].load(a,o.$child)}},ko.virtualElements.allowedBindings["export"]=!0,ko.bindingHandlers.componentShadyDom={init:function(e,n,t,i,o){var r=createComponentShadyDomAccesor(o);return o.$parentContext.$data=o.$parent.getScope(),o.$parentContext.$rawData=o.$parent.getScope(),ko.bindingHandlers.template.init(e,r,t,o.$parent.getScope(),o.$parentContext)},update:function(e,n,t,i,o){var r=createComponentShadyDomAccesor(o);return o.$parentContext.$data=o.$parent.getScope(),o.$parentContext.$rawData=o.$parent.getScope(),ko.bindingHandlers.template.update(e,r,t,o.$parent.getScope(),o.$parentContext)}},ko.virtualElements.allowedBindings.componentShadyDom=!0,ko.bindingHandlers.modelExporter={init:function(e,n,t,i,o){var r=createModelExporterAccessor(e,n,t,i,o),a=o.$parentContext.$parentContext.extend({$child:o.$parent.getModel(),$childContext:o});return ko.bindingHandlers.template.init(e,r,t,o.$parent,a)},update:function(e,n,t,i,o){var r=createModelExporterAccessor(e,n,t,i,o),a=o.$parentContext.$parentContext.extend({$child:o.$parent.getModel(),$childContext:o});return ko.bindingHandlers.template.update(e,r,t,o.$parent,a)}},ko.virtualElements.allowedBindings.modelExporter=!0,ko.bindingHandlers.call={init:function(e,n,t,i,o){var r=ko.unwrap(n());r()}},ko.virtualElements.allowedBindings.call=!0,ko.bindingHandlers.inject={init:function(e,n,t,i,o){injectBinding(n,i,o)},update:function(e,n,t,i,o){injectBinding(n,i,o)}},ko.virtualElements.allowedBindings.inject=!0,ko.bindingHandlers.content={init:function(e,n,t,i,o){var r=createContentAccesor(e,n,t,i,o),a=o.$parentContext.extend({$child:i,$childContext:o});return ko.bindingHandlers.template.init(e,r,t,o.$parent,a)},update:function(e,n,t,i,o){var r=createContentAccesor(e,n,t,i,o),a=o.$parentContext.extend({$child:i,$childContext:o});return ko.bindingHandlers.template.update(e,r,t,o.$parent,a)}},ko.virtualElements.allowedBindings.content=!0,ko.bindingHandlers.hasContent={init:function(e,n,t,i,o){var r=createHasContentAccesor(e,n,t,i,o);return ko.bindingHandlers["if"].init(e,r,t,o,o)}},ko.virtualElements.allowedBindings.hasContent=!0,ko.bindingHandlers.hasNotContent={init:function(e,n,t,i,o){var r=createHasContentAccesor(e,n,t,i,o);return ko.bindingHandlers.ifnot.init(e,r,t,o,o)}},ko.virtualElements.allowedBindings.hasNotContent=!0,ko.bindingHandlers.stopBinding={init:function(e,n,t,i,o){return{controlsDescendantBindings:!0}}},ko.bindingHandlers.page={init:function(e,n,t,i,o){var r=createPageAccessor(e,n,t,i,o);return ko.bindingHandlers.component.init(e,r,t,i,o)}},$$.routing=new QuarkRouter,$$.redirect=function(e){return window.location.href=e,!0},$$.getParam=function(e){var n=void 0,t=[];return location.search.substr(1).split("&").forEach(function(i){t=i.split("="),t[0]===e&&(n=decodeURIComponent(t[1]))}),n},$$.replaceAndBind=function(e,n,t){$(e).html(n),ko.cleanNode(e.get(0)),ko.applyBindings(t,e.get(0))},$$.block=function(e,n){e||(e="Loading...");var t={message:e,css:{border:"none",padding:"5px",backgroundColor:"#000","-webkit-border-radius":"5px","-moz-border-radius":"5px",opacity:.7,color:"#fff"},baseZ:5e3};n?$(n).block(t):$.blockUI(t)},$$.unblock=function(e){e?$(e).unblock():$.unblockUI()},$$.htmlEncode=function(e){return e?$("<div />").text(e).html():""},$$.htmlDecode=function(e){return e?$("<div />").html(e).text():""},$$.limitText=function(e,n){return $$.isInt(n)?6>n&&(n=6):n=6,$$.isString(e)?(e.length>n&&(e=e.substr(0,n-3)+"..."),e):""},$$.setCookie=function(e,n,t){var i=new Date;if(void 0!==t){i.setTime(i.getTime()+1e3*t);var o="expires="+i.toUTCString();document.cookie=e+"="+n+"; "+o}else document.cookie=e+"="+n+"; "},$$.getCookie=function(e){e+="=";for(var n=document.cookie.split(";"),t=0;t<n.length;t++){for(var i=n[t];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return""},$$.clearCookie=function(e){$$.setCookie(e,"",-1)},$$.clientErrorHandlers={},$$.serverErrorHandlers={},$$.ajax=function(e,n,t,i,o){var r=o||{},a=i||{};if(!e)throw"Must specify the target URL";$$.isDefined(r.headers)||(r.headers={}),r.auth&&(r.headers={access_token:sessionStorage.getItem("token")});var s;$$.isFunction(a)?s=a:$$.isObject(a)&&(s=a.onSuccess),$.ajax({url:e,type:r.method||"GET",cache:r.cache||!1,data:t,async:r.async||!0,success:s,headers:r.headers||{},error:function(n,t,i){var o=!1;if($$.isDefined(a.onError)&&(o=a.onError()),!o)if(n.status>=500&&n.status<600){for(var r in $$.serverErrorHandlers)if($$.serverErrorHandlers[r](e,JSON.parse(n.responseText))){o=!0;break}}else for(r in $$.clientErrorHandlers)if($$.clientErrorHandlers[r](e,n,t,i)){o=!0;break}}})},ko.isObservableArray=function(e){return ko.isObservable(e)&&void 0!==e.indexOf?!0:!1},ko.isComputed=function(e){return null===e||void 0===e||void 0===e.__ko_proto__?!1:e.__ko_proto__===ko.dependentObservable?!0:ko.isComputed(e.__ko_proto__)},ko.getJson=function(e){var n=komapping.toJS(e);n=clearFields(n);var t=komapping.toJSON(n);return t=t.replace(/\/Date\(\d+\)/g,function(e){return"\\"+e+"\\"})},ko.bindingHandlers.onBind={init:function(e,n,t,i,o){var r=ko.unwrap(n());r(e,i,o)}},ko.bindingHandlers.rowSelect={update:function(e,n,t,i,o){var r=ko.unwrap(n()),a=function(){return $$.isFunction(r.isSelected)?{success:r.isSelected(i)}:{success:r.isSelected}};ko.bindingHandlers.css.update(e,a,t,i,o);var s=function(){return r.select};ko.bindingHandlers.click.init(e,s,t,i,o)}},ko.bindingHandlers.numericValue={init:function(e,n){var t=n(),i=ko.pureComputed({read:function(){return $$.isDefined(t())?accounting.formatNumber(t(),2,".",","):void 0},write:function(e){var n=t(),i=accounting.unformat(e,",");isNaN(i)&&(i=e),i!==n?t(accounting.toFixed(i,2)):e!==n.toString()&&t.valueHasMutated()}});ko.applyBindingsToNode(e,{value:i})}},ko.bindingHandlers.moneyValue={init:function(e,n){var t=n(),i=ko.pureComputed({read:function(){return $$.isDefined(t())?accounting.formatMoney(t(),"$ ",2,".",","):void 0},write:function(e){var n=t(),i=accounting.unformat(e,",");isNaN(i)&&(i=e),i!==n?t(accounting.toFixed(i,2)):e!==n.toString()&&t.valueHasMutated()}});ko.applyBindingsToNode(e,{value:i})}},ko.validators={},ko.validate=function(e,n){var t=!0;for(var i in e){var o=e[i];ko.isObservable(o)&&o.validatable&&(o.validate(n)||(t=!1))}return t},ko.validationReset=function(e){for(var n in e){var t=e[n];ko.isObservable(t)&&t.validatable&&t.validationReset()}},ko.observable.fn.validation=function(e,n,t){return this.validatable=e,this.validationConfig={},this.validationConfig=n,this.hasError=ko.observable(),this.validationMessage=ko.observable(),t&&(this.parent=t,t.validationSummary||(t.validationSummary=ko.observableArray())),this},ko.observable.fn.validationReset=function(){var e=this;this.validatable&&(this.hasError(!1),this.validationMessage(""),this.parent&&this.parent.validationSummary.remove(function(n){return n.name===e.validatable}))},ko.observable.fn.validate=function(e){return e&&!this.subscription&&(this.subscription=this.subscribe(validateValue,this)),validateValue(this())},ko.bindingHandlers.formGroupError={init:function(e,n,t,i,o){setFormGroupErrorClass(e,n,t,i,o)},update:function(e,n,t,i,o){setFormGroupErrorClass(e,n,t,i,o)}},"function"==typeof define&&define.amd&&define("knockout",function(){return ko}),$$});
