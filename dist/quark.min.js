!function(e,t){"function"==typeof define&&define.amd?define(["knockout","jquery","knockout-mapping","accounting-js","crossroads","hasher","blockui"],t):(e.komapping=ko.mapping,e.$$=t(e.ko,e.$,e.komapping,e.accounting,e.crossroads,e.hasher))}(this,function(e,t,n,i,r,a){function o(e,t){if(!g.isString(t))throw"The behaviour name must be an string. If you specified an array check that all elements are valid behaviour names";if(!b[t])throw"The are no behaviours loaded with the name "+t+".";b[t](e),g.isDefined(e.behaviours)||(e.behaviours={}),e.behaviours[t]=!0}function s(e){var t=function(){return{nodes:e.$componentTemplateNodes}};return t}function c(e,t,n,i,r){var a=function(){for(var t=Array(),n=e.parentNode.parentNode,i=0;i<n.attributes.length;i++){var r=n.attributes[i];r.specified&&0===r.name.indexOf("qk-")&&(t.push(document.createComment("ko "+r.name.replace("qk-","")+": "+r.value)),t.push(document.createComment("/ko")))}return{nodes:t,"if":t.length>0}};return a}function u(t,n,i){var r=e.unwrap(t()),a=i.$child,o=r;g.isObject(r)&&g.isDefined(r.data)&&g.isDefined(r.target)&&(a=r.target,o=r.data),g.inject(o,a)}function d(n,i,r,a,o){var s=e.unwrap(i()),c=function(){return g.isInt(s)?{nodes:o.$componentTemplateNodes.slice(s)}:{nodes:t(o.$componentTemplateNodes).filter(s)}};return c}function l(n,i,r,a,o){var s=e.unwrap(i()),c=function(){return t(o.$componentTemplateNodes).filter(s).length>0};return c}function f(t,n,i,r,a){var o=e.unwrap(n()),s=function(){var t=g.routing.current();return{name:e.pureComputed(function(){return t.route.components[o]}),params:t}};return s}function h(){function n(){var e=this;e.configuration={};var t;this.on=function(n,i){if(!g.isString(n))throw"The page must be an string with the pattern of the pathname to match.";if(!g.isDefined(i))throw"Must define a name for the routes on the page.";return e.configuration[i]={pattern:n,routes:{}},t=i,e},this.when=function(n,i,r){if(g.isDefined(i)||g.isDefined(r)){if(!g.isDefined(r)||!g.isDefined(i))throw"Must define the url, name and components parameters"}else r=n,i="",n="Any";if(!g.isDefined(t))throw"You must define the location to where this route applies using the .on method before calling .when.";var a=t+"/"+i;return e.configuration[t].routes[i]={url:n,components:r,fullName:a,name:i},e}}function i(e,t,n,i,r,a){var s=this,c=e.addRoute(r,function(e){o.current({route:s,location:location.pathname,params:e})});this.name=t,this.fullName=n,this.locationPattern=i,this.url=r,this.components=a,this.parse=function(t){e.parse(t)},this.interpolate=function(e){return c.interpolate(e)}}var o=this;this.current=e.observable(),this.configuration=[],this.routes=function(){return new n},this.configure=function(e){for(var n in e.configuration){var a=e.configuration[n],s=e.configuration[n].pattern,c=r.create();c.normalizeFn=r.NORM_AS_OBJECT,a.router=c;for(var u in a.routes)if(""!==u){var d,l=a.routes[u];d=l.components,g.isDefined(a.routes[""])&&t.extend(d,a.routes[""].components);var f=new i(c,l.name,l.fullName,s,l.url,d);l.route=f}}o.configuration=e.configuration},this.parse=function(e,t){g.isDefined(t)||(t=e,e=window.location.pathname);for(var n in o.configuration){var i=o.configuration[n],r=RegExp(i.pattern);if(e.match(r))return i.router.parse(t)}},this.getRoute=function(e){var t=e.split("/");if(2!=t.length)throw new"You must specifiy route name in the form pageName/routeName";return o.configuration[t[0]]&&o.configuration[t[0]].routes[t[1]]?o.configuration[t[0]].routes[t[1]].route:void 0},this.hash=function(e,t){var n=o.getRoute(e);return n?n.interpolate(t):void 0},this.link=function(e,t,n){var i=o.getRoute(e);return n||(n=i.locationPattern),i?n+"#"+i.interpolate(t):void 0},this.listLocation=function(e){g.isDefined(e)||(e=window.location.pathname);for(var t in o.configuration){var n=o.configuration[t],i=RegExp(n.pattern);if(e.match(i))return n.routes}},this.activateHasher=function(){function e(e,t){o.parse(e)}a.initialized.add(e),a.changed.add(e),a.init()}}function p(e){for(var t in e)null===e[t]||void 0===e[t]?delete e[t]:"object"==typeof e[t]&&p(e[t]);return e}function v(t){this.validationReset();for(var n in this.validationConfig){var i=this.validationConfig[n];if(e.validators[n]){var r=e.validators[n](this,i);if(!r.validate(t))return this.parent&&this.parent.validationSummary.push({name:this.validatable,message:this.validationMessage()}),!1}}return!0}function m(e,n,i,r,a){var o=n(),s=!1;if(g.isArray(o))for(var c=0;c<o.length;c++)o[c].hasError()||(s=!0);else s=o.hasError();s?t(e).addClass("has-error"):t(e).removeClass("has-error")}var g={};g.isDefined=function(e){return"undefined"==typeof e?!1:!0},g.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},g.isInt=function(e){return Number(e)===e&&e%1===0},g.isNumeric=function(e){return"number"==typeof e},g.isDecimal=function(e){return e===Number(e)&&e%1!==0},g.isArray=function(e){return t.isArray(e)},g.isObject=function(e){return null===e||"object"!=typeof e||e instanceof Array?!1:!0},g.isFunction=function(e){return null!==e&&"function"==typeof e?!0:!1},g.isDate=function(e){return e instanceof Date?!0:!1},g.isValidDate=function(e){return g.isDate(e)?isNaN(e.getTime())?!1:!0:!1},g.clone=function(e){return t.extend(!0,{},e)},g.cloneObservable=function(e){return n.fromJS(n.toJS(e))},g.cloneMixed=function(t){var n=new t.constructor;for(var i in t){var r;e.isObservable(t[i])?(r=t[i](),g.isObject(r)?n[i]=e.observable(g.cloneMixed(r)):n[i]=e.observable(r)):(r=t[i],g.isObject(r)?n[i]=g.cloneMixed(r):n[i]=r)}return n},g.call=function(t){if(e.isObservable(t)&&(t=t()),e.isObservable(t))throw"Callback can not be an observable";if(g.isFunction(t)){var n=Array.prototype.slice.call(arguments,1);return t.apply(null,n)}},g.makeDate=function(e,t){if(g.isDate(e)||(e=new Date(e)),!g.isValidDate(e)){if(!t)return void 0;e=new Date}return e},g.component=function(e,t){function n(t){var n,i={};e&&!n&&(n=new e(t,i)),this.getModel=function(){return n},this.getScope=function(){return i},this.dispose=function(){n&&n.dispose&&n.dispose(),i&&i.dispose&&i.dispose(),n=void 0,i=void 0}}return g.isDefined(t)||(t=e,e=void 0),e?{template:t,viewModel:n}:{template:t}},g.config=function(t,n,i){if(!g.isObject(t))throw"You must specify a config object";if(!g.isObject(n))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!g.isDefined(i))throw"You must specify the viewmodel of the component in wich to load the configuration.";g.isArray(i)||(i=Array(i));for(var r in t)for(var a=0;a<i.length;a++){var o=i[a];g.isDefined(o.config)||(o.config={}),g.isDefined(o.config[r])&&console.warn("There is already a config property named "+r+" in the target component. The property will be replaced."),o.config[r]=t[r],e.isObservable(o.config[r])&&console.warn("Property "+r+" should not be observable. The configuration parameters should be static, if you want the object to react to parameter changes use the parameters method."),g.isDefined(n[r])&&(e.isObservable(n[r])?o.config[r]=n[r]():o.config[r]=n[r])}},g.parameters=function(t,n,i){if(!g.isObject(t))throw"You must specify a parameters config object";if(!g.isObject(n))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!g.isDefined(i))throw"You must specify the viewmodel of the component in wich to load the parameters.";g.isArray(i)||(i=Array(i));for(var r in t)for(var a=0;a<i.length;a++){var o=i[a];if(g.isDefined(o[r])&&console.warn("There is already a property named "+r+" in the target component. It will be replaced with the specified parameter."),o[r]=t[r],g.isDefined(n[r]))if(e.isObservable(o[r])&&e.isObservable(n[r]))e.isComputed(o[r])||(o[r]=n[r]);else if(e.isObservable(o[r])&&!e.isObservable(n[r]))o[r](n[r]);else if(!e.isObservable(o[r])&&e.isObservable(n[r]))o[r]=n[r]();else if(!e.isObservable(o[r])&&!e.isObservable(n[r]))if(g.isFunction(o[r])){if(g.isFunction(n[r]))o[r]=n[r];else if(g.isDefined(n[r]))throw"The parameter "+r+" must be a callback."}else o[r]=n[r]}},g.inject=function(t,n,i){if(g.isDefined(t)&&g.isDefined(n))for(var r in t)if(g.isDefined(n[r])){var a;a=e.isObservable(t[r])?t[r]():t[r],e.isObservable(n[r])?i&&g.isObject(n[r]())?g.inject(n[r](),a):n[r](a):i&&g.isObject(n[r])?g.inject(n[r],a):n[r]=a}};var b={};return g.behaviour=function(e,t){if(g.behaviour[e]&&console.warn("There was already a behaviour loaded with the name "+e+". It will be replaced with the new one."),!g.isString(e))throw"The behaviour name must be an string.";if(!g.isFunction(t))throw"The behaviour must be a function that takes an object as a parameter an applies the new functionality to it.";b[e]=t},g.behave=function(e,t){if(!g.isObject(e))throw"You must specifify a valid object to apply the behaviour.";if(g.isArray(t))for(var n=0;n<t.length;n++)o(e,t[n]);else{if(!g.isString(t))throw"The behaviour name must be an string or an array of strings.";o(e,t)}},g.hasBehaviour=function(e,t){if(!g.isObject(e))throw"You must specifify a valid object to check the behaviour.";if(!g.isString(t))throw"The behaviour name must be an string.";return g.isDefined(e.behaviours)&&g.isDefined(e.behaviours[t])?!0:!1},e.computedParameter=function(t,n,i){return e.isObservable(t)||(t=e.observable(t)),e.computed({read:function(){return n.read(t)},write:function(e){return n.write(t,e)}},i)},e.components.register("quark-component",{template:"<!-- ko componentShadyDom --><!-- /ko --><!-- ko modelExporter --><!-- /ko -->"}),e.bindingHandlers["import"]={init:function(e,t,n,i,r){var a=i,o=t();if(!g.isString(o))throw"The import value must be an string with the name of the property to create on the parent object";g.isObject(a.tracking)||(a.tracking={childs:{}}),a.tracking.childs[o]={},a.tracking.childs[o].load=function(e,t){a[e]=t,a.tracking.childs[e].loaded=!0,g.isDefined(a.loaded)&&a.loaded(e,t),g.isDefined(t.tracking)?(a.tracking.childs[e].ready=!1,t.tracking.parent=a,t.tracking.parentState=a.tracking.childs[e]):(a.tracking.childs[e].ready=!0,g.isDefined(a.readied)&&a.readied(e,t),g.isDefined(t.ready)&&t.ready());for(var n in a.tracking.childs)if(!a.tracking.childs[n].loaded||!a.tracking.childs[n].ready)return;g.isFunction(a.ready)&&a.ready(),g.isDefined(a.tracking)&&g.isDefined(a.tracking.parent)&&(a.tracking.parentState.ready=!0,g.isDefined(a.tracking.parent.readied)&&a.tracking.parent.readied(e,t),a.tracking.parent.childReady())},a.tracking.childs[o].loaded=!1,a.tracking.childReady=function(){for(var e in a.tracking.childs)if(!a.tracking.childs[e].ready)return;g.isFunction(a.ready)&&a.ready(),g.isDefined(a.parent)&&(a.traking.parentState.ready=!0,a.tracking.parent.childReady())},a[o]={},e.setAttribute("qk-export","'"+o+"'")}},e.bindingHandlers["export"]={init:function(t,n,i,r,a){var o;o=e.unwrap(n());var s;if(g.isString(o)?s=o:g.isObject(o)&&(g.isString(o.property)&&(s=o.property),g.isDefined(o.model)&&(r=o.model)),!g.isString(s))throw"The value of the vm value must be an string with the name of the property where quark must load the viewmodel of the nested component";if(!g.isDefined(r.tracking))throw"The specified object doesn´t have the tracking.childs property. This usually is because you don´t used the function .components to set the properties where the vm binding has to set the viewmodel";if(!g.isDefined(r.tracking.childs))throw"The specified object doesn´t have the tracking property. This usually is because you don´t used the function .components to set the properties where the vm binding has to set the viewmodel";if(!g.isDefined(r.tracking.childs[s]))throw"The specified object doesn´t have a property named "+o+". Verify that the object has a property defined with the .components method with the name defined in the vm binding.";r.tracking.childs[s].load(s,a.$child)}},e.virtualElements.allowedBindings["export"]=!0,e.bindingHandlers.componentShadyDom={init:function(t,n,i,r,a){var o=s(a);return a.$parentContext.$data=a.$parent.getScope(),a.$parentContext.$rawData=a.$parent.getScope(),e.bindingHandlers.template.init(t,o,i,a.$parent.getScope(),a.$parentContext)},update:function(t,n,i,r,a){var o=s(a);return a.$parentContext.$data=a.$parent.getScope(),a.$parentContext.$rawData=a.$parent.getScope(),e.bindingHandlers.template.update(t,o,i,a.$parent.getScope(),a.$parentContext)}},e.virtualElements.allowedBindings.componentShadyDom=!0,e.bindingHandlers.modelExporter={init:function(t,n,i,r,a){var o=c(t,n,i,r,a),s=a.$parentContext.$parentContext.extend({$child:a.$parent.getModel(),$childContext:a});return e.bindingHandlers.template.init(t,o,i,a.$parent,s)},update:function(t,n,i,r,a){var o=c(t,n,i,r,a),s=a.$parentContext.$parentContext.extend({$child:a.$parent.getModel(),$childContext:a});return e.bindingHandlers.template.update(t,o,i,a.$parent,s)}},e.virtualElements.allowedBindings.modelExporter=!0,e.bindingHandlers.call={init:function(t,n,i,r,a){var o=e.unwrap(n());o()}},e.virtualElements.allowedBindings.call=!0,e.bindingHandlers.inject={init:function(e,t,n,i,r){u(t,i,r)},update:function(e,t,n,i,r){u(t,i,r)}},e.virtualElements.allowedBindings.inject=!0,e.bindingHandlers.content={init:function(t,n,i,r,a){var o=d(t,n,i,r,a),s=a.$parentContext.extend({$child:r,$childContext:a});return e.bindingHandlers.template.init(t,o,i,a.$parent,s)},update:function(t,n,i,r,a){var o=d(t,n,i,r,a),s=a.$parentContext.extend({$child:r,$childContext:a});return e.bindingHandlers.template.update(t,o,i,a.$parent,s)}},e.virtualElements.allowedBindings.content=!0,e.bindingHandlers.hasContent={init:function(t,n,i,r,a){var o=l(t,n,i,r,a);return e.bindingHandlers["if"].init(t,o,i,a,a)}},e.virtualElements.allowedBindings.hasContent=!0,e.bindingHandlers.hasNotContent={init:function(t,n,i,r,a){var o=l(t,n,i,r,a);return e.bindingHandlers.ifnot.init(t,o,i,a,a)}},e.virtualElements.allowedBindings.hasNotContent=!0,e.bindingHandlers.page={init:function(t,n,i,r,a){var o=f(t,n,i,r,a);return e.bindingHandlers.component.init(t,o,i,r,a)}},g.routing=new h,g.redirect=function(e){return window.location.href=e,!0},g.getParam=function(e){var t=void 0,n=[];return location.search.substr(1).split("&").forEach(function(i){n=i.split("="),n[0]===e&&(t=decodeURIComponent(n[1]))}),t},g.replaceAndBind=function(n,i,r){t(n).html(i),e.cleanNode(n.get(0)),e.applyBindings(r,n.get(0))},g.block=function(e,n){e||(e="Loading...");var i={message:e,css:{border:"none",padding:"5px",backgroundColor:"#000","-webkit-border-radius":"5px","-moz-border-radius":"5px",opacity:.7,color:"#fff"},baseZ:5e3};n?t(n).block(i):t.blockUI(i)},g.unblock=function(e){e?t(e).unblock():t.unblockUI()},g.htmlEncode=function(e){return e?t("<div />").text(e).html():""},g.htmlDecode=function(e){return e?t("<div />").html(e).text():""},g.limitText=function(e,t){return g.isInt(t)?6>t&&(t=6):t=6,g.isString(e)?(e.length>t&&(e=e.substr(0,t-3)+"..."),e):""},g.setCookie=function(e,t,n){var i=new Date;if(void 0!==n){i.setTime(i.getTime()+1e3*n);var r="expires="+i.toUTCString();document.cookie=e+"="+t+"; "+r}else document.cookie=e+"="+t+"; "},g.getCookie=function(e){e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return""},g.clearCookie=function(e){g.setCookie(e,"",-1)},g.clientErrorHandlers={},g.serverErrorHandlers={},g.ajax=function(e,n,i,r,a){var o=a||{},s=r||{};if(!e)throw"Must specify the target URL";g.isDefined(o.headers)||(o.headers={}),o.auth&&(o.headers={access_token:sessionStorage.getItem("token")});var c;g.isFunction(s)?c=s:g.isObject(s)&&(c=s.onSuccess),t.ajax({url:e,type:o.method||"GET",cache:o.cache||!1,data:i,async:o.async||!0,success:c,headers:o.headers||{},error:function(t,n,i){var r=!1;if(g.isDefined(s.onError)&&(r=s.onError()),!r)if(t.status>=500&&t.status<600){for(var a in g.serverErrorHandlers)if(g.serverErrorHandlers[a](e,JSON.parse(t.responseText))){r=!0;break}}else for(a in g.clientErrorHandlers)if(g.clientErrorHandlers[a](e,t,n,i)){r=!0;break}}})},e.isObservableArray=function(t){return e.isObservable(t)&&void 0!==t.indexOf?!0:!1},e.isComputed=function(t){return null===t||void 0===t||void 0===t.__ko_proto__?!1:t.__ko_proto__===e.dependentObservable?!0:e.isComputed(t.__ko_proto__)},e.getJson=function(e){var t=n.toJS(e);t=p(t);var i=n.toJSON(t);return i=i.replace(/\/Date\(\d+\)/g,function(e){return"\\"+e+"\\"})},e.bindingHandlers.onBind={init:function(t,n,i,r,a){var o=e.unwrap(n());o(t,r,a)}},e.bindingHandlers.rowSelect={update:function(t,n,i,r,a){var o=e.unwrap(n()),s=function(){return g.isFunction(o.isSelected)?{success:o.isSelected(r)}:{success:o.isSelected}};e.bindingHandlers.css.update(t,s,i,r,a);var c=function(){return o.select};e.bindingHandlers.click.init(t,c,i,r,a)}},e.bindingHandlers.numericValue={init:function(t,n){var r=n(),a=e.pureComputed({read:function(){return g.isDefined(r())?i.formatNumber(r(),2,".",","):void 0},write:function(e){var t=r(),n=i.unformat(e,",");isNaN(n)&&(n=e),n!==t?r(i.toFixed(n,2)):e!==t.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(t,{value:a})}},e.bindingHandlers.moneyValue={init:function(t,n){var r=n(),a=e.pureComputed({read:function(){return g.isDefined(r())?i.formatMoney(r(),"$ ",2,".",","):void 0},write:function(e){var t=r(),n=i.unformat(e,",");isNaN(n)&&(n=e),n!==t?r(i.toFixed(n,2)):e!==t.toString()&&r.valueHasMutated()}});e.applyBindingsToNode(t,{value:a})}},e.validators={},e.validate=function(t,n){var i=!0;for(var r in t){var a=t[r];e.isObservable(a)&&a.validatable&&(a.validate(n)||(i=!1))}return i},e.validationReset=function(t){for(var n in t){var i=t[n];e.isObservable(i)&&i.validatable&&i.validationReset()}},e.observable.fn.validation=function(t,n,i){return this.validatable=t,this.validationConfig={},this.validationConfig=n,this.hasError=e.observable(),this.validationMessage=e.observable(),i&&(this.parent=i,i.validationSummary||(i.validationSummary=e.observableArray())),this},e.observable.fn.validationReset=function(){var e=this;this.validatable&&(this.hasError(!1),this.validationMessage(""),this.parent&&this.parent.validationSummary.remove(function(t){return t.name===e.validatable}))},e.observable.fn.validate=function(e){return e&&!this.subscription&&(this.subscription=this.subscribe(v,this)),v(this())},e.bindingHandlers.formGroupError={init:function(e,t,n,i,r){m(e,t,n,i,r)},update:function(e,t,n,i,r){m(e,t,n,i,r)}},"function"==typeof define&&define.amd&&define("knockout",function(){return e}),g});
