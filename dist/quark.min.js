!function(e,n){"function"==typeof define&&define.amd?define(["knockout","jquery","knockout-mapping","crossroads","hasher","signals"],n):(e.komapping=ko.mapping,e.$$=n(e.ko,e.$,e.komapping,e.crossroads,e.hasher,e.signals))}(this,function(e,n,t,r,i,a){function o(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(e,n,t){return e.replace(new RegExp(o(n),"g"),t)}function u(e){var n=e||!1,t=O.signal();this.lock=function(){n=!1},this.forceLock=function(){n=!0},this.unlock=function(){n=!0,t.dispatch()},this.isLocked=function(){return!n},this.call=function(e){n?e():t.addOnce(function(){n=!0,e()})},this.dispose=function(){O.signalClear(t)}}function l(e,n,t,r,i){this.key=e,this.message=r,this.data=i,this.controller=n,this.component=t,this.level=i&&i.level?i.level:2e3,this.type=i&&i.type?i.type:"",this.constructor.prototype.__proto__=Error.prototype}function d(n,t){var r=this;O.isDefined(n)||(n=""),O.isDefined(t)||(t="");var i=e.pureComputed(function(){var e=[],r=E();for(var i in r){var a=r[i];""==n&&""==t&&e.push(a),a.controller==n&&""==t&&e.push(a),a.controller==n&&a.component==t&&e.push(a)}return e});this.add=function(e,r){var i=T++,a=new l(i,n,t,e,r);return E.push(a),i},this["throw"]=function(e,n){var t=r.add(e,n);throw r.getByKey(t)},this.resolve=function(e){var n=r.getByKey(e);n&&E.remove(n)},this.getBy=function(n){return e.pureComputed(function(){var e=[],t=i();for(var r in t){var a=t[r];n(a)&&e.push(a)}return e})},this.getByKey=function(e){var n=i();for(var t in n){var r=n[t];if(r.key==e)return r}},this.getByType=function(n){return e.pureComputed(function(){var e=[],t=i();for(var r in t){var a=t[r];a.type==n&&e.push(a)}return e})},this.getByLevel=function(n,t){return e.pureComputed(function(){var e=[],r=i();for(var a in r){var o=r[a];o.level>=n&&o.level<=t&&e.push(o)}return e})},this.get=function(){return i},this.clear=function(){E.removeAll(i())}}function c(e,n,t){if(!O.isString(e))throw"The behaviour name must be an string. If you specified an array check that all elements are valid behaviour names";if(!H[e])throw"The are no behaviours loaded with the name "+e+".";H[e](n,t),O.isDefined(n.$support)||(n.$support={}),O.isDefined(n.$support.behaviours)||(n.$support.behaviours={}),n.$support.behaviours[e]=!0}function f(e){var n=function(){return{nodes:e.$componentTemplateNodes}};return n}function p(e){var n=e.$parent,t=e.$parentContext,r=e.extend({$component:n.getModel(),$componentTemplateNodes:t.$componentTemplateNodes,$data:n.getScope(),$parent:t.$parent?t.$parent.model:void 0,$parentContext:t.$parentContext,$parents:t.$parents,$rawData:n.getScope(),$root:t.$root});return O.isArray(r.$parents)&&r.$parents[0]&&r.$parents[0].model&&(r.$parents[0]=r.$parents[0].model),r}function v(n,t){for(var r=e.virtualElements.childNodes(n),i=0;i<r.length;i++)if(r[i]==t)return!0;return!1}function m(e){for(var n=e.previousSibling;null!=n;){if(v(n,e))return n;n=n.previousSibling}return null==n?e.parentNode:void 0}function h(e){if(8==e.nodeType){var n=e.nodeValue.match(/model-bind[\s]*:[\s]*\"[\s\S]*?\"/);if(n){var t=n[0].match(/\"[\s\S]*?\"/);if(t){var r=t[0].indexOf('"')+1,i=t[0].indexOf('"',r);return t[0].substring(r,i)}}}else if(e.attributes)for(var a=0;a<e.attributes.length;a++){var o=e.attributes[a];if(o.specified&&"model-bind"==o.name)return o.value}return!1}function b(e){var n=function(){var n=Array(),t=m(e);t=m(t);var r=h(t);return r&&(n.push(document.createComment(" ko "+r+" ")),n.push(document.createComment(" /ko "))),{nodes:n,"if":n.length>0}};return n}function g(e){var n=e.$parentContext.$parentContext,t=e.$parent,r=n.extend({$child:t.getModel(),$childContext:e.$parentContext});return r}function y(){function e(e){this.name=e,this.loaded=!1,this.ready=!1,this.model=void 0,this.tracker=void 0}function n(){for(var e in i){var n=i[e];if(!n.loaded||!n.ready)return!1}return!0}var t,r=this,i={},a=!1,o="";this.ready=O.lock(),this.loaded=O.signal(),this.readied=O.signal(),this.isReady=function(){return!O.isLocked(r.ready)},this.addDependency=function(n){r.ready.lock(),i[n]=new e(n)},this.removeDependency=function(e){if(i[e]){var n=i[e].tracker;n&&(n.parent=""),delete i[e]}},this.loadDependency=function(e,n,t){i[e].model=n,i[e].tracker=t,i[e].loaded=!0,r.loaded.dispatch(e,n),t?(t.setParent(r,e),t.isReady()?r.readyDependency(e):i[e].ready=!1):r.readyDependency(e)},this.readyDependency=function(e){i[e].ready=!0,r.readied.dispatch(e,i[e].model),n()&&(r.ready.unlock(),a&&a.readyDependency(o,t,r))},this.setMainModel=function(e){t=e},this.setParent=function(e,n){a=e,o=n},this.get=function(e){var n=i[e];return n?n.model:void 0},this.dispose=function(){r.ready.dispose(),O.signalClear(r.loaded),O.signalClear(r.readied);for(var e in i)r.removeDependency(e)}}function w(e,n,t){if(8==e.nodeType){var r=e.nodeValue.match(/model-bind[\s]*:[\s]*\"[\s\S]*?\"/);if(r){var i=r[0].match(/\"[\s\S]*?\"/);if(i){var a=i[0].indexOf('"')+1,o=i[0].indexOf('"',a),s=i[0].substring(a,o),u='"'+s;s&&(u+=", "),u+=t+": '"+n+"'\"",e.nodeValue=e.nodeValue.replace(i[0],u)}}else e.nodeValue+='model-bind: "'+t+": '"+n+"'\""}else{var l=!1;if(e.attributes)for(var d=0;d<e.attributes.length;d++){var c=e.attributes[d];c.specified&&"model-bind"==c.name&&(c.value&&(c.value+=", "),c.value+=t+": '"+n+"'",l=!0)}if(!l)var c=e.setAttribute("model-bind",t+": '"+n+"'")}}function C(t,r,i){var a=e.unwrap(t()),o=r.get("virtual")||!1,s=function(){if(o){for(var e=[],t=0,r=0;r<i.$componentTemplateNodes.length;r++){var s=i.$componentTemplateNodes[r];8==s.nodeType&&s.nodeValue.trim().toUpperCase()==a.toUpperCase()&&t++,t>0&&(e.push(s),8==s.nodeType&&s.nodeValue.trim().toUpperCase()=="/"+a.toUpperCase()&&t--)}return{nodes:e}}if(O.isDefined(a)){var u=n(i.$componentTemplateNodes).filter(a);return{nodes:u}}return{nodes:i.$componentTemplateNodes}};return s}function k(e){var n=e.$parentContext,t=e.$data,r=n.extend({$containerContext:e,$container:t.model});return r}function x(t,r,i){var a=e.unwrap(t()),o=r.get("virtual")||!1,s=function(){if(o){for(var e=0;e<i.$componentTemplateNodes.length;e++){var t=i.$componentTemplateNodes[e];if(8==t.nodeType&&t.nodeValue.trim().toUpperCase()==a.toUpperCase())return!0}return!1}return n(i.$componentTemplateNodes).filter(a).length>0};return s}function $(){function t(e){var n,t=m.name();if(!t)return{index:0};n=t.split("/");for(var r,i=e.split("/"),a=0;a<i.length;a++){if(n[a]!=i[a])return{index:a,fullName:r};r=r?r+"/"+n[a]:n[a]}return{index:i.length,fullName:r}}function a(){}function o(e,n){e&&m.controllers[e]&&(m.controllers[n].parent=m.controllers[e])}function s(e,n,t){var r=[];if(e&&(r=e.split("/")),n.index<r.length){var i=r[n.index],u=n.fullName,l=n.fullName?n.fullName+"/"+i:i,d={index:n.index+1,fullName:l};require([p.controllersBase+"/"+l],function(n){var r=new y,i=new n(r);r.setMainModel(i),r.ready.forceLock(),m.trackers[l]=r,m.controllers[l]=i,o(u,l),s(e,d,t)},function(n){m.controllers[l]=new a,o(u,l),s(e,d,t)})}else t()}function u(e){var n=m.name(),t=[];n&&(t=n.split("/"));for(var r=e.fullName,i=e.index;i<t.length;i++){var a=t[i];r=r?r+"/"+a:a;var o=m.controllers[r],s=m.trackers[r];o&&(O.isFunction(o.dispose)&&o.dispose(),o.parent&&delete o.parent),s&&s.dispose(),delete m.controllers[r],delete m.trackers[r]}}function l(e){var n=m.name(),t=[];n&&(t=n.split("/"));for(var r=e.fullName,i=e.index;i<t.length;i++){var a=t[i];r=r?r+"/"+a:a;var o=h[r],s=m.controllers[r];for(var u in o)s.outlets[u]="empty"}}function d(n,t){var r=[];n&&(r=n.split("/"));for(var i=t.fullName,a=t.index;a<r.length;a++){var o=r[a];i=i?i+"/"+o:o;var s=m.controllers[i],u=h[i];s.outlets||(s.outlets={});for(var l in u)s.outlets[l]=u[l];var d=C[i];if(s.params||(s.params={}),d)for(var c=0;c<d.length;c++)s.params[d[c]]=e.observable()}}function c(e,n){var t,r=[];n&&(r=n.split("/"));for(var i=0;i<r.length;i++){var a=r[i];if(t=t?t+"/"+a:a,C[t]){var o=m.controllers[t];if(o&&o.params)for(var s in o.params){var u=e[s];o.params[s](u)}}}}function f(e,n){g[e]=v.addRoute(n,function(n){var r=t(e);l(r),u(r),s(e,r,function(){d(e,r),c(n,e),m.name(e)})})}var p=this;this.controllersBase="controllers";var v=r.create();v.normalizeFn=r.NORM_AS_OBJECT,v.ignoreState=!0;var m={name:e.observable(),controllers:{},trackers:{}};this.current=m.name;var h={},b={},g={},C={};this.pages=function(e,t){n.extend(h,e),t&&n.extend(C,t)},this.mapRoute=function(e){for(var n in e){var t=e[n];f(n,t),b[n]=t}},this.parse=function(e){v.parse(e)},this.activateHasher=function(e){function n(n,t){O.isDefined(e)?e(n,t):p.parse(n)}i.initialized.add(n),i.changed.add(n),i.init()},e.bindingHandlers.outlet={init:function(n,t,r,i,a){var o,s=e.unwrap(t()),u=e.observable({name:"empty"}),l=m.name.subscribe(function(e){var n=[];e&&(n=e.split("/"));for(var t,r,i,a,l,d=0;d<n.length;d++){var c=n[d];r=r?r+"/"+c:c;var t=m.controllers[r],f=m.trackers[r];for(var p in t.outlets)p==s&&(i=t.outlets[p],a=t,l=f)}if(i){if(i!=u().name||a!=o){var v={name:i};a&&a.initComponent?v.params=a.initComponent(s,i):v.params={},l.addDependency(s),o=a,u(v)}}else o="",u({name:"empty"})});e.utils.domNodeDisposal.addDisposeCallback(n,function(){l.dispose(),o=""}),w(n,s,"exportToController"),e.applyBindingsToNode(n,{component:u})}},e.virtualElements.allowedBindings.outlet=!0,e.bindingHandlers.exportToController={init:function(n,t,r,i,a){var o=e.unwrap(t()),s=[],u=m.name();u&&(s=u.split("/"));for(var l,d,c,f,p,v=0;v<s.length;v++){var h=s[v];d=d?d+"/"+h:h;var l=m.controllers[d],b=m.trackers[d];for(var g in l.outlets)g==o&&(c=l.outlets[g],f=l,p=b)}if(f&&p){var y=a.$childContext.$data.getModel(),w=a.$childContext.$data.getImports();p.loadDependency(o,y,w)}f="",p=""}},e.virtualElements.allowedBindings.exportToController=!0}function D(n,t){t||(t=this),t.validationReset();for(var r in t.validationConfig){var i=t.validationConfig[r];if(e.validators[r]){var a=e.validators[r](t,i);if(!a.validate(n))return t.componentErrors&&(t.errorKey=t.componentErrors.add(t.validationMessage(),{level:100,type:"validation"})),!1}}return!0}function N(e,t,r,i,a){var o=t(),s=!1;if(O.isArray(o)){for(var u=0;u<o.length;u++)if(!o[u].hasError()){s=!0;break}}else s=o.hasError();s?n(e).addClass("has-error"):n(e).removeClass("has-error")}var O={};O.started=!1,O.ajaxErrorHandlers={},O.formatters={},O.isDefined=function(e){return"undefined"==typeof e?!1:!0},O.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},O.isInt=function(e){return Number(e)===e&&e%1===0},O.canBeInt=function(e){return Number(e)==e&&e%1===0},O.isNumeric=function(e){return"number"==typeof e},O.isDecimal=function(e){return e===Number(e)&&e%1!==0},O.isArray=function(e){return n.isArray(e)},O.isObject=function(e){return null===e||"object"!=typeof e||e instanceof Array?!1:!0},O.isFunction=function(e){return null!==e&&"function"==typeof e?!0:!1},O.isDate=function(e){return e instanceof Date?!0:!1},O.isValidDate=function(e){return O.isDate(e)?isNaN(e.getTime())?!1:!0:!1},O.clone=function(e){return n.extend(!0,{},e)},O.cloneObservable=function(e){return t.fromJS(t.toJS(e))},O.cloneMixed=function(n){var t=new n.constructor;for(var r in n){var i;e.isObservable(n[r])?(i=n[r](),O.isObject(i)?t[r]=e.observable(O.cloneMixed(i)):t[r]=e.observable(i)):(i=n[r],O.isObject(i)?t[r]=O.cloneMixed(i):t[r]=i)}return t},O.call=function(n){if(e.isObservable(n)&&(n=n()),e.isObservable(n))throw"Callback can not be an observable";if(O.isFunction(n)){var t=Array.prototype.slice.call(arguments,1);return n.apply(null,t)}},O.makeDate=function(e,n){if(O.isDate(e)||(e=new Date(e)),!O.isValidDate(e)){if(!n)return void 0;e=new Date}return e},O.toShortISO=function(e){return O.isDate(e)?e.toISOString().slice(0,10):void 0},O.clear=function(t){n.each(t,function(n,t){e.isObservable(t)?t(void 0):t=void 0})},O.undefine=function(n){e.isObservable(n)?n(void 0):n=void 0},O.formatString=function(){for(var e=Array.prototype.slice.call(arguments),n=e[0],t=1;t<e.length;t++)n=s(n,"{"+(t-1)+"}",e[t]);return n},O.formatStringObj=function(e,n){for(var t in n)e=s(e,"{"+t+"}",n[t]);return e},e.associativeObservable=function(n){function t(){return arguments.length>0?(t.underlying(arguments[0]),this):t.underlying()}return t.underlying=e.observable(n),t.add=function(e,n){var r=t.underlying();r||(r={}),r[e]=n,t.underlying(r)},t.get=function(e){var n=t.underlying();return n?n[e]:void 0},t.remove=function(e){var n=t.underlying();n&&O.isDefined(n[e])&&delete n[e],t.underlying(n)},t.array=e.pureComputed(function(){var e=t.underlying(),n=[];if(e)for(var r in e){var i=e[r];n.push(i)}return n}),t.each=function(e){var n=t.underlying();if(n)for(var r in n)e(r,n[r])},t.subscribe=function(e){return t.underlying.subscribe(e)},t},e.observable.fn.refresh=function(){var e=this();O.undefine(this),this(e)},e.isObservableArray=function(n){return e.isObservable(n)&&void 0!==n.indexOf?!0:!1},e.isComputed=function(n){return null===n||void 0===n||void 0===n.__ko_proto__?!1:n.__ko_proto__===e.dependentObservable?!0:e.isComputed(n.__ko_proto__)},e.mapToJS=function(e){return t.toJS(t.fromJS(e))},e.mapFromJS=function(e){return t.fromJS(t.toJS(e))},e.bindingHandlers.href={update:function(n,t,r,i,a){var o=e.unwrap(t()),s=function(){return O.isString(o)?{href:O.routing.link(o)}:O.isObject(o)&&o&&o.routeName&&o.routeConfig?{href:O.routing.link(o.routeName,o.routeConfig)}:void 0};return e.bindingHandlers.attr.update(n,s,r,i,a)}},e.bindingHandlers.onBind={init:function(n,t,r,i,a){var o=e.unwrap(t());o(n,i,a)}},e.bindingHandlers.format={init:function(n,t){var r=t();if(!O.isDefined(r.value)||!O.isString(r.formatter))throw"Must specify format configuration in the form { value: observableValue, formatter: formatterName }";e.isObservable(r.value)||(r.value=e.observable(r.value));var i=e.pureComputed({read:function(){return O.isDefined(r.value())&&O.isDefined(r.formatter)?O.formatters[r.formatter](r.value()):r.value()}});e.applyBindingsToNode(n,{text:i})}},e.bindingHandlers.formatValue={init:function(n,t){var r=t();if(!O.isDefined(r.value)||!O.isString(r.formatter))throw"Must specify format configuration in the form { value: observableValue, formatter: formatterName }";e.isObservable(r.value)||(r.value=e.observable(r.value));var i=e.pureComputed({read:function(){return O.isDefined(r.value())&&O.isDefined(r.formatter)?O.formatters[r.formatter](r.value()):r.value()}});e.applyBindingsToNode(n,{value:i})}},e.bindingHandlers.waitReady={init:function(n,t,r,i,a){var o=t(),s=e.observable(!1);return i&&i.readiedSignal&&i.readiedSignal.addOnce(function(e){e==o&&s(!0)}),e.bindingHandlers["if"].init(n,s,r,i,a)}},e.virtualElements.allowedBindings.waitReady=!0,O.signal=function(){return new a.Signal},O.signalClear=function(e){e.removeAll()},O.lock=function(e){return new u(e||!1)},O.wait=function(e,n){e.call(n)},O.isLocked=function(e){return e.isLocked()},O.redirect=function(e){return window.location.href=e,!0},O.redirectHash=function(e,n){var t=O.routing.hash(e,n);O.redirect("#"+t)},O.getParam=function(e){var n=void 0,t=[];return location.search.substr(1).split("&").forEach(function(r){t=r.split("="),t[0]===e&&(n=decodeURIComponent(t[1]))}),n},O.replaceAndBind=function(t,r,i){n(t).html(r),e.cleanNode(t.get(0)),e.applyBindings(i,t.get(0))},O.htmlEncode=function(e){return e?n("<div />").text(e).html():""},O.htmlDecode=function(e){return e?n("<div />").html(e).text():""},O.limitText=function(e,n){return O.isInt(n)?6>n&&(n=6):n=6,O.isString(e)?(e.length>n&&(e=e.substr(0,n-3)+"..."),e):""},O.setCookie=function(e,n,t){var r=new Date;if(void 0!==t){r.setTime(r.getTime()+1e3*t);var i="expires="+r.toUTCString();document.cookie=e+"="+n+"; "+i}else document.cookie=e+"="+n+"; "},O.getCookie=function(e){e+="=";for(var n=document.cookie.split(";"),t=0;t<n.length;t++){for(var r=n[t];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return""},O.clearCookie=function(e){O.setCookie(e,"",-1)},O.loadCss=function(e){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,document.getElementsByTagName("head")[0].appendChild(n)};var S=!1;O.ajaxConfig={contentType:"application/json",dataType:"json",async:!0,cache:!1,authorization:{has:function(){return!0},configAuthorization:function(e){return e},authorize:function(e,n){n(!0)}}},O.ajax=function(e,t,r,i,a,o){function s(){c=c.authorization.configAuthorization(c),n.ajax(c)}var u=o||{},l=i||{};if(!e)throw"Must specify the target URL";var d;O.isFunction(l)?d=l:O.isObject(l)&&(d=l.onSuccess);var c={url:e,type:t||"GET",data:r,success:d,complete:function(){O.isDefined(l.onComplete)&&l.onComplete()},error:function(n,t,r){var i=!1;if(O.isDefined(l.onError)&&(i=l.onError(n,t,r)),!i)for(var a in O.ajaxErrorHandlers)if(O.ajaxErrorHandlers[a](e,u.source,n,t,r)){i=!0;break}}};c=n.extend(c,O.ajaxConfig),c=n.extend(c,u),!S&&a?c.authorization.has()?s():(S=!0,c.authorization.authorize(function(e){S=!1,e&&s()})):n.ajax(c)};var T=1,E=e.observableArray();O.globalErrors=new d,O.modules=e.associativeObservable({}),O.start=function(n){O.started||(e.applyBindings(n),O.started=!0)},O.module=function(e,n,t){function r(e,n){for(var t in n){var a,o=n[t];a=t?e+"-"+t:e,O.isString(o)?O.registerComponent(a,i+"/"+o):r(a,o)}}if(!O.isDefined(e))throw"Must specify the module configuration. You can define 'module' as dependency and pass that value in this parameter";var i=e.id.substring(0,e.id.lastIndexOf("/")),a=e.uri.substring(0,e.uri.lastIndexOf("/"));if(O.modules.get(i))return O.modules.get(i);if(n||(n={}),O.isDefined(n.require)){if(n.require.paths)for(var o in n.require.paths)n.require.paths[o]=a+"/"+n.require.paths[o];require(n.require)}if(n.components)for(var s in n.components){var u=n.prefix+"-"+s,l=i+"/"+n.components[s];O.registerComponent(u,l)}if(n.namespaces&&(n.prefix?r(n.prefix,n.namespaces):r("",n.namespaces)),n.routes&&O.routing.configure(n.routes),O.isArray(n.css))for(var d=0;d<n.css.length;d++)O.loadCss(a+"/"+n.css[d]);var c={};return t&&(c=new t(i)),c.start&&c.start(),O.modules.add(i,{name:i,path:a,info:e,config:n,main:c}),O.modules.get(i)},O.component=function(e,n){function t(n){var t,r={},i=new y;e&&!t&&(t=new e(n,r,i),i.setMainModel(t),i.ready.forceLock(),t&&O.isFunction(t.initComponent)&&t.initComponent(),r.model=t,r.imports=i),this.getModel=function(){return t},this.getScope=function(){return r},this.getImports=function(){return i},this.dispose=function(){t&&t.dispose&&t.dispose(),r&&r.dispose&&r.dispose(),i&&i.dispose(),t&&t.ready,delete t,delete r,delete i}}return O.isDefined(n)||(n=e,O.undefine(e)),e?{template:n,viewModel:t,modelType:e}:{template:n}},O.parameters=function(n,t,r){if(!O.isObject(n))throw"You must specify a parameters config object";if(!O.isObject(t))throw"You must specify the configured values for the component, usually you can obtain it from the parameters array received in the component's constructor.";if(!O.isDefined(r))throw"You must specify the viewmodel of the component in wich to load the parameters.";O.isArray(r)||(r=Array(r));for(var i in n)for(var a=0;a<r.length;a++){var o=r[a];if(O.isDefined(o[i])&&console.warn("There is already a property named "+i+" in the target component. It will be replaced with the specified parameter."),o[i]=n[i],O.isDefined(t[i]))if(e.isObservable(o[i])&&e.isObservable(t[i]))o[i]=t[i];else if(e.isObservable(o[i])&&!e.isObservable(t[i]))o[i](t[i]);else if(!e.isObservable(o[i])&&e.isObservable(t[i]))o[i]=t[i]();else if(!e.isObservable(o[i])&&!e.isObservable(t[i]))if(O.isFunction(o[i])){if(O.isFunction(t[i]))o[i]=t[i];else if(O.isDefined(t[i]))throw"The parameter "+i+" must be a callback."}else o[i]=t[i]}},O.inject=function(n,t,r){if(O.isDefined(n)&&O.isDefined(t))for(var i in n)if(O.isDefined(t[i])){var a;a=e.isObservable(n[i])?n[i]():n[i],e.isObservable(t[i])?r&&O.isObject(t[i]())?O.inject(a,t[i](),!0):t[i](a):r&&O.isObject(t[i])?O.inject(a,t[i],!0):t[i]=a}},O.emptyTemplate=function(e){return e?"<!-- quark-component --><!-- /quark-component -->":"<quark-component></quark-component>"},O.registerComponent=function(n,t){e.components.register(n,{require:t})},e.components.register("empty",{template:" "}),O.onNamespace=function(e,n){var t=this,r=e;return this.register=function(e,n){return O.registerComponent(r+"-"+e,n),t},this.namespace=function(e){return new O.onNamespace(r+"-"+e,t)},this.endNamespace=function(){return n},t};var H={};return O.behaviour=function(e,n,t){if(O.behaviour[e]&&console.warn("There was already a behaviour loaded with the name "+e+". It will be replaced with the new one."),!O.isString(e))throw"The behaviour name must be an string.";if(!O.isFunction(n))throw"The behaviour must be a function that takes an object as a parameter an applies the new functionality to it.";if(O.isDefined(t)&&!O.isFunction(t))throw"The behaviour dispose must be a function that performs cleanup of the behaviour when disposing.";n.dispose=t,H[e]=n},O.behave=function(e,n,t){if(!O.isObject(n))throw"You must specifify a valid object to apply the behaviour.";if(O.isArray(e))for(var r=0;r<e.length;r++)c(e[r],n,t);else{if(!O.isString(e))throw"The behaviour name must be an string or an array of strings.";c(e,n,t)}},O.hasBehaviour=function(e,n){if(!O.isObject(e))throw"You must specifify a valid object to check the behaviour.";if(!O.isString(n))throw"The behaviour name must be an string.";return O.isDefined(e.$support)&&O.isDefined(e.$support.behaviours)&&O.isDefined(e.$support.behaviours[n])?!0:!1},O.disposeBehaviours=function(e){if(!O.isObject(e))throw"You must specifify a valid object to apply the behaviour.";if(O.isDefined(e.$support)&&O.isDefined(e.$support.behaviours))for(var n in e.$support.behaviours){var t=e.$support.behaviours[n];t.dispose&&t.dispose(e)}},e.components.register("quark-component",{template:"<!-- ko componentScope --><!-- /ko --><!-- ko modelBinder --><!-- /ko -->"}),e.bindingHandlers.componentScope={init:function(n,t,r,i,a){var o=f(a),s=p(a);return e.bindingHandlers.template.init(n,o,r,s.$data,s)},update:function(n,t,r,i,a){var o=f(a),s=p(a);return e.bindingHandlers.template.update(n,o,r,s.$data,s)}},e.virtualElements.allowedBindings.componentScope=!0,e.bindingHandlers.modelBinder={init:function(n,t,r,i,a){var o=b(n),s=g(a);return e.bindingHandlers.template.init(n,o,r,a.$parent,s)},update:function(n,t,r,i,a){var o=b(n),s=g(a);return e.bindingHandlers.template.update(n,o,r,a.$parent,s)}},e.virtualElements.allowedBindings.modelBinder=!0,e.bindingHandlers["import"]={init:function(e,n,t,r,i){var a,o,s=n();r&&r.imports&&r.model?(a=r.model,o=r.imports):(a=r,o=r),o.addDependency(s),w(e,s,"export")}},e.virtualElements.allowedBindings["import"]=!0,e.bindingHandlers["export"]={init:function(n,t,r,i,a){var o;o=e.unwrap(t());var s,u;i&&i.model&&i.imports&&(s=i.model,u=i.imports);var l;if(!O.isString(o))throw"The value of the vm value must be an string with the name of the property where quark must load the viewmodel of the nested component";if(l=o,u){var d=a.$childContext.$data.getModel(),c=a.$childContext.$data.getImports();u.loadDependency(l,d,c)}}},e.virtualElements.allowedBindings["export"]=!0,e.bindingHandlers.content={init:function(n,t,r,i,a){var o=C(t,r,a),s=k(a);return e.bindingHandlers.template.init(n,o,r,a.$parent,s)},update:function(n,t,r,i,a){var o=C(t,r,a),s=k(a);return e.bindingHandlers.template.update(n,o,r,a.$parent,s)}},e.virtualElements.allowedBindings.content=!0,e.bindingHandlers.hasContent={init:function(n,t,r,i,a){var o=x(t,r,a);return e.bindingHandlers["if"].init(n,o,r,a,a)}},e.virtualElements.allowedBindings.hasContent=!0,e.bindingHandlers.hasNotContent={init:function(n,t,r,i,a){var o=x(t,r,a);return e.bindingHandlers.ifnot.init(n,o,r,a,a)}},e.virtualElements.allowedBindings.hasNotContent=!0,e.bindingHandlers.innerHtml={init:function(t,r,i,a,o){var s=e.unwrap(r());n(t).html(s)}},e.virtualElements.allowedBindings.innerHtml=!0,O.routing=new $,e.bindingHandlers.namespace={init:function(e,n,t,r,i){var a=n(),o=t.get("alias");if(!O.isString(a))throw"Must specify namespace as string. The binding must be in the form: namespace: 'namespace', alias: 'alias'";if(!O.isString(o))throw"Must specify alias to namespace as string. The binding must be in the form: namespace: 'namespace', alias: 'alias'";var s=a.toLowerCase();o=o.toLowerCase(),i&&(i.namespaces||(i.namespaces={}),i.namespaces[o]=s)}},e.virtualElements.allowedBindings.namespace=!0,e.bindingProvider.instance.preprocessNode=function(n){if(8==n.nodeType){var t=n.nodeValue.match(/^\s*(quark-component[\s\S]+)/);if(t)return n.data=" ko component: { name: 'quark-component' } ",n;var t=n.nodeValue.match(/^\s*(\/quark-component[\s\S]+)/);if(t)return n.data=" /ko ",n}if(n&&n.nodeName&&e.components.isRegistered(n.nodeName.toLowerCase())&&n.attributes.virtual){var r=n.attributes.params,i=n.attributes["data-bind"],a=n.attributes["model-bind"],o=" ko component: { name: '"+n.nodeName.toLowerCase()+"' ";o+=r?", params: { "+r.value+" } ":", params: {}",o+=" } ",i&&(o+=", "+i.value+" "),a&&(o+=', model-bind: "'+a.value+'"');var s=document.createComment(o),u=document.createComment(" /ko ");for(n.parentNode.insertBefore(u,n.nextSibling),n.parentNode.replaceChild(s,n);n.childNodes.length>0;)s.parentNode.insertBefore(n.childNodes[0],u);return[s,u]}},e.components.getComponentNameForNode=function(n){var t=n.tagName&&n.tagName.toLowerCase();if(e.components.isRegistered(t))return t;if(-1!==t.indexOf(":")){var r=t.split(":"),i=r[0],a=r[1],o=e.contextFor(n);if(o&&O.isObject(o.namespaces)&&o.namespaces[i]){var s=o.namespaces[i],u=s+"-"+a;if(e.components.isRegistered(u))return u}}return null},e.validators={},e.validate=function(n,t){var r=!0;for(var i in n){var a=n[i];e.isObservable(a)&&a.validatable&&(a.validate(t)||(r=!1))}return r},e.unsubscribeValidation=function(n){for(var t in n){var r=n[t];e.isObservable(r)&&r.validatable&&r.validationSubscription&&(r.validationSubscription.dispose(),delete r.validationSubscription)}},e.validationReset=function(n){for(var t in n){var r=n[t];e.isObservable(r)&&r.validatable&&r.validationReset()}},e.observable.fn.validation=function(n,t,r){return this.validatable=n,this.validationConfig=t,this.hasError=e.observable(),this.validationMessage=e.observable(),r&&(this.componentErrors=r),this},e.observable.fn.validationReset=function(){this.validatable&&(this.hasError(!1),this.validationMessage(""),this.componentErrors&&this.errorKey&&this.componentErrors.resolve(this.errorKey))},e.observable.fn.validate=function(e){return e&&!this.validationSubscription&&(this.validationSubscription=this.subscribe(D,this)),D(this(),this)},e.bindingHandlers.formGroupError={init:function(e,n,t,r,i){N(e,n,t,r,i)},update:function(e,n,t,r,i){N(e,n,t,r,i)}},e.bindingHandlers.fieldError={init:function(n,t,r,i,a){var o=function(){return t().validationMessage};e.bindingHandlers.text.init(n,o,r,i,a)},update:function(n,t,r,i,a){var o=function(){return t().hasError},s=function(){return t().validationMessage};e.bindingHandlers.visible.update(n,o,r,i,a),e.bindingHandlers.text.update(n,s,r,i,a)}},"function"==typeof define&&define.amd&&define("knockout",function(){return e}),O});